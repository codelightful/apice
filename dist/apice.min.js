var Apice=function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?s(e):t}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=a(e);if(t){var i=a(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return c(this,n)}}function u(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||h(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=h(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function v(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,g(e,t,"get"))}function p(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,g(e,t,"set"),n),n}function g(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function y(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var m={isPromise:function(e){return e instanceof Promise},trim:function(e){return e?e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""):""}},w=/\{(\d+)\}/g;m.placeholders=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i={output:e,unbind:n};if("string"!=typeof e||!n||0===n.length)return i;var a,o={},s=e.matchAll(w),c=d(s);try{for(c.s();!(a=c.n()).done;){var l=a.value,u=l[1];if(u&&!o[u]){o[u]=!0;var h=new RegExp("\\{"+u+"\\}","g"),f=n[u];void 0!==f&&(i.unbind[u]=null,i.output=i.output.replace(h,f))}}}catch(e){c.e(e)}finally{c.f()}return i.unbind=i.unbind.filter((function(e){return null!=e})),i};var b={set:function(e,t,n){if(e){"number"!=typeof n&&(console.warn("Invalid timespan has been provided. Setting the default value"),n=3600);var r=new Date;r.setTime(r.getTime()+1e3*n);var i=m.trim(e)+"="+t+"; expires="+r.toGMTString()+"; path=/";document.cookie=i}else console.warn("Unable to set a cookie without name")},get:function(e){if(!e)return null;for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var r=m.trim(t[n]);if(r){var i=r.split("=");if(m.trim(i[0])===e)return i[1]}}return null}},k={},E={loggers:{},levels:{fatal:{value:10,color:"#ff4444",label:"FATAL"},error:{value:20,color:"#ff4444",label:"ERROR"},warn:{value:30,color:"#ff8800",label:"WARN"},info:{value:40,color:"#0099cc",label:"INFO"},debug:{value:50,color:"#3E4551",label:"DEBUG"},trace:{value:60,color:"#3E4551",label:"TRACE"}}},M=b.get("apice.logger.level");M?(E.globalLevel=E.levels[M],E.globalLevel||(E.globalLevel=E.levels.warn)):E.globalLevel=E.levels.warn;var W=new WeakMap,_=new WeakMap,T=new WeakSet,S=function(){function e(n){t(this,e),T.add(this),W.set(this,{writable:!0,value:void 0}),_.set(this,{writable:!0,value:void 0}),p(this,W,n);var r=b.get("apice.logger.["+n+"].level");r?(p(this,_,E.levels[r]),v(this,_)||p(this,_,E.globalLevel)):p(this,_,E.globalLevel)}return r(e,[{key:"name",get:function(){return v(this,W)}},{key:"level",value:function(){if(0!==arguments.length){var e=E.levels[arguments[0]];if(!e)throw new Error("apice.logger.invalid_level["+arguments[0]+"]");p(this,_,e),b.set("apice.logger.["+v(this,W)+"].level",arguments[0],1800)}return v(this,_).label}},{key:"fatal",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=y(this,T,x)).call.apply(t,[this,E.levels.fatal,e].concat(r))}},{key:"error",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=y(this,T,x)).call.apply(t,[this,E.levels.error,e].concat(r))}},{key:"warn",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=y(this,T,x)).call.apply(t,[this,E.levels.warn,e].concat(r))}},{key:"info",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=y(this,T,x)).call.apply(t,[this,E.levels.info,e].concat(r))}},{key:"debug",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=y(this,T,x)).call.apply(t,[this,E.levels.debug,e].concat(r))}},{key:"trace",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=y(this,T,x)).call.apply(t,[this,E.levels.trace,e].concat(r))}}]),e}();function x(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(v(this,_).value>=e.value){var a;if("string"!=typeof t)t=JSON.stringify(t);else if(r&&r.length>0){var o=m.placeholders.apply(m,[t].concat(u(r)));t=o.output,r=o.unbind}(a=console).log.apply(a,["%c["+e.label+"]["+v(this,W)+"]: "+t].concat(["color: "+e.color].concat(u(r))))}}k.getLogger=function(e){return e||(e="system"),E.loggers[e]||(E.loggers[e]=new S(e)),E.loggers[e]},k.level=function(){var e;if(1===arguments.length){var t=E.levels[arguments[0]];if(!t)throw new Error("apice.logger.invalid_level["+arguments[0]+"]");for(var n in E.globalLevel=t,b.set("apice.logger.level",arguments[0],1800),E.loggers){var r=E.loggers[n];r.level(arguments[0])}}else if(2===arguments.length){var i=k.getLogger(arguments[1]);return i.level(arguments[0]),i.level()}return null===(e=E.globalLevel)||void 0===e?void 0:e.label};var A={addListener:function(e,t,n){if(!e)throw new Error("apice.util.event.invalid_target");if(!t||"string"!=typeof t)throw new Error("apice.util.event.invalid_event_name");"function"==typeof n&&("function"==typeof e.addEventListener?e.addEventListener(t,n,!1):"function"==typeof e.attachEvent&&e.attachEvent("on"+t,n))},documentReady:function(e){"complete"===document.readyState?e():"function"==typeof document.addEventListener?document.addEventListener("DOMContentLoaded",e,!1):"function"==typeof document.attachEvent&&document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&e()}))}},L={};function C(e){if(!e||"string"!=typeof e)return null;var t=document.createElement("div");return t.innerHTML=e,u(t.childNodes)}var R=function e(){t(this,e)},P=new WeakMap,N=function(e){i(a,e);var n=l(a);function a(e){var r;return t(this,a),r=n.call(this),P.set(s(r),{writable:!0,value:void 0}),p(s(r),P,e),r}return r(a,[{key:"isValid",get:function(){return!!v(this,P)}},{key:"id",get:function(){return v(this,P)?v(this,P).id:null}},{key:"each",value:function(e){return"function"==typeof e&&v(this,P)&&e(v(this,P)),this}},{key:"content",value:function(){var e=this;if(0===arguments.length)return v(this,P)?v(this,P).innerHTML:null;if(v(this,P)){var t=arguments[0];t?B(t)?(v(this,P).innerHTML="",v(this,P).appendChild(t)):t instanceof R?(v(this,P).innerHTML="",t.each((function(t){v(e,P).append(t)}))):v(this,P).innerHTML=t:v(this,P).innerHTML=""}return this}},{key:"append",value:function(){var e=this;if(v(this,P)&&arguments.length>0)if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.append(arguments[t]);else{var n=arguments[0];if(n instanceof R)n.each((function(t){v(e,P).appendChild(t)}));else if("string"==typeof n){n=C(n);for(var r=0;r<n.length;r++)v(this,P).appendChild(n[r])}else if(B(n))v(this,P).appendChild(n);else if(n instanceof NodeList)for(var i=0;i<n.length;i++){var a=n[i];v(this,P).appendChild(a)}}return this}},{key:"prepend",value:function(){var e=this;if(v(this,P)&&arguments.length>0)if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.prepend(arguments[t]);else{var n=v(this,P).firstChild,r=arguments[0];if(r instanceof R)r.each((function(t){v(e,P).insertBefore(t,n)}));else if("string"==typeof r){r=C(r);for(var i=0;i<r.length;i++)v(this,P).insertBefore(r[i],n)}else if(B(r))v(this,P).insertBefore(r,n);else if(r instanceof NodeList)for(var a=0;a<r.length;a++){var o=r[a];v(this,P).insertBefore(o,n)}}return this}},{key:"on",value:function(e,t){if(!e)throw new Error("apice.element.on.no_event_name");return v(this,P)&&"function"==typeof t&&A.addListener(v(this,P),e,t),this}},{key:"click",value:function(){return 0===arguments.length||"function"!=typeof arguments[0]||this.on("click",arguments[0]),this}},{key:"select",value:function(e){return e&&"string"==typeof e?I(v(this,P),e):null}}]),a}(R),j=new WeakMap,O=new WeakSet,H=function(e){i(a,e);var n=l(a);function a(){var e;return t(this,a),e=n.call(this),O.add(s(e)),j.set(s(e),{writable:!0,value:void 0}),p(s(e),j,[]),e}return r(a,[{key:"add",value:function(e){return e&&v(this,j).push(e),this}},{key:"each",value:function(){return y(this,O,F).call(this,"each",arguments),this}},{key:"content",value:function(){return 0===arguments.length?y(this,O,F).call(this,"content",arguments):(y(this,O,F).call(this,"content",arguments),this)}},{key:"append",value:function(){return y(this,O,F).call(this,"append",arguments),this}},{key:"prepend",value:function(){return y(this,O,F).call(this,"prepend",arguments),this}},{key:"on",value:function(){return y(this,O,F).call(this,"on",arguments),this}},{key:"click",value:function(){return y(this,O,F).call(this,"click",arguments),this}},{key:"select",value:function(){return y(this,O,F).call(this,"select",arguments),this}}]),a}(R);function F(e,t){for(var n=[],r=0;r<v(this,j).length;r++){var i=v(this,j)[r],a=i[e];if("function"==typeof a)try{var o=a.apply(i,t);Array.isArray(o)?n.push.apply(n,u(o)):n.push(o)}catch(t){console.log("itaca.element.node_call[".concat(e,"]"),t)}}return n}function B(t){return t&&"object"===e(t)&&1===t.nodeType}function I(e,t){var n=e.querySelectorAll(t);if(0===n.length)return null;if(1===n.length)return new N(n[0]);for(var r=new H,i=0;i<n.length;i++){var a=n[i];r.add(new N(a))}return r}var q=function(e){return e?"body"===e||e===document.body?(L.bodySingleton||(L.bodySingleton=new N(document.body)),L.bodySingleton):"string"==typeof e?I(document,e):e instanceof R?e:B(e)?new N(e):null:null};function z(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function U(){return z()+z()}q.append=function(e,t){if(e&&t){if("body"===t||t===document.body)throw Error("apice.element.append.source_cannot_be_body");if("string"==typeof t){var n=t.charAt(0);if("#"===n||"."===n||"["===n){var r=document.querySelector(t);if(!r)throw Error("apice.element.append.unknown_source[".concat(t,"]"));t=r}}var i=q(e);if(!i)throw Error("apice.element.append.unknown_target[".concat(e,"]"));i.append(t)}};var X={tinyId:z,shortId:U,guid:function(){return U()+"-"+U()+"-"+U()+"-"+U()+U()}},D={},G=new WeakMap,$=new WeakMap,J=new WeakMap,V=new WeakMap,K=new WeakMap,Q=new WeakSet,Y=function(){function e(n){t(this,e),Q.add(this),G.set(this,{writable:!0,value:void 0}),$.set(this,{writable:!0,value:void 0}),J.set(this,{writable:!0,value:void 0}),V.set(this,{writable:!0,value:void 0}),K.set(this,{writable:!0,value:void 0}),p(this,K,X.guid()),p(this,$,n.message),p(this,J,n.cause),p(this,G,n.module),p(this,V,n.code)}return r(e,[{key:"guid",get:function(){return v(this,K)}},{key:"message",get:function(){var e;return null!==(e=v(this,$))&&void 0!==e?e:"An error has occurred. Please contact the technical support without closing this screen."}},{key:"cause",get:function(){return v(this,J)}},{key:"code",get:function(){return v(this,V)}},{key:"log",value:function(){var e=k.getLogger(v(this,G)),t="ref=[".concat(v(this,K),"]");v(this,V)&&(t+="\n-> (c) ".concat(v(this,V))),t+=y(this,Q,Z).call(this,v(this,J)),e.error(t)}},{key:"render",value:function(e){this.log();var t=q(e);t?t.content('<div class="apc-badge apc-error">            <div class="apc-header">Atention!</div>            <div class="apc-body">'.concat(this.message,'</div>            <div class="apc-footer">').concat(v(this,K),"</div>        </div>")):Apice.ui.toast.error("".concat(this.message,"<div>").concat(v(this,K),"</div>"))}}]),e}();function Z(e){return e?"string"==typeof e?"\n-> (s) ".concat(e):e instanceof Error?"\n-> (e) ".concat(e.stack):v(this,J)instanceof Y?"\n-> (n) ".concat(e.code)+y(this,Q,Z).call(this,e.cause):v(this,J)instanceof te?"\n-> (h) http-error[".concat(e.code,"]"):void 0:""}D.create=function(t){if(!t)return console.error("apice.error_handler.create.null_input"),null;var n=e(t);if("string"===n)t={code:t};else if(t instanceof Error)t={cause:t};else if("object"!==n)return console.error("apice.error_handler.create.invalid_input",t),null;return new Y(t)},D.render=function(e,t){e&&(e instanceof Y||(e=D.create(e)),e.render(t))};var ee=new WeakMap,te=function(){function e(n){t(this,e),ee.set(this,{writable:!0,value:void 0}),p(this,ee,n)}return r(e,[{key:"type",get:function(){return"http"}},{key:"code",get:function(){return v(this,ee)}}]),e}();D.createHttpError=function(e){return new te(e)},window.addEventListener("unhandledrejection",(function(e){e.reason instanceof Y&&(e.preventDefault(),e.reason.render())}));var ne={};function re(e,t){var n=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){throw Error("apice.http.xmlhttp_creation_error")}}}();return n.onreadystatechange=function(){4!=n.readyState&&"complete"!==n.readyState||(200==n.status?e(n.responseText):t(D.createHttpError(n.status)))},n}ne.request=function(e,t){return"string"==typeof e&&e?(t||(t={}),t.method||(t.method="GET"),new Promise((function(n,r){var i=re(n,r);i.open(t.method,e,!1!==t.async),"GET"!==t.method&&t.data?i.send(t.data):i.send()}))):Promise.reject("apice.http.null_url")},ne.loadScript=function(e){return new Promise((function(t,n){var r=document.createElement("script");r.src=e,r.type="text/javascript",r.async=!1,r.onerror=function(){n(D.create({module:"apice.http",code:"apice.http.load_script_error[".concat(e,"]")}))},r.onload=function(){t()},document.head.appendChild(r)}))};var ie=new WeakMap,ae=new WeakMap,oe=new WeakMap,se=new WeakMap,ce=function(){function e(n,r,i,a){if(t(this,e),ie.set(this,{writable:!0,value:void 0}),ae.set(this,{writable:!0,value:void 0}),oe.set(this,{writable:!0,value:void 0}),se.set(this,{writable:!0,value:void 0}),!v(this,ae))throw new Error("apice.http.url.no_host");p(this,ie,null!=n?n:"https"),p(this,ae,r),p(this,oe,null!=i?i:"80"),p(this,se,null!=a?a:"")}return r(e,[{key:"protocol",get:function(){return v(this,ie)}},{key:"host",get:function(){return v(this,ae)}},{key:"port",get:function(){return v(this,oe)}},{key:"path",get:function(){return v(this,se)}},{key:"toString",value:function(){return v(this,ie)+"://"+v(this,ae)+":"+v(this,oe)+"/"+v(this,se)}},{key:"resourceUrl",value:function(e,t,n){var r=this.toString();return e&&"string"==typeof e&&(r.endsWith("/")||e.startsWith("/")||(r+="/"),r+=e),t&&"string"==typeof t&&(t.startsWith("?")||(r+="?"),r+=t),n&&"string"==typeof n&&(n.startsWith("#")||(r+="#"),r+=n),r}},{key:"get",value:function(e,t,n){var r=this.resourceUrl(e,t,n);return ne.request(r,{method:"GET"})}},{key:"post",value:function(e,t){var n=this.resourceUrl(e);return ne.request(n,{method:"POST",data:t})}},{key:"put",value:function(e,t){var n=this.resourceUrl(e);return ne.request(n,{method:"PUT",data:t})}},{key:"delete",value:function(e,t){var n=this.resourceUrl(e);return ne.request(n,{method:"DELETE",data:t})}}]),e}(),le=new WeakMap,ue=new WeakMap,he=new WeakMap,fe=new WeakMap,de=function(){function n(){t(this,n),le.set(this,{writable:!0,value:void 0}),ue.set(this,{writable:!0,value:void 0}),he.set(this,{writable:!0,value:void 0}),fe.set(this,{writable:!0,value:void 0})}return r(n,[{key:"protocol",value:function(e){return p(this,le,e),this}},{key:"host",value:function(e){return p(this,ue,e),this}},{key:"port",value:function(t){var n=e(t);if("string"===n)p(this,he,t);else{if("number"!==n)throw new Error("apice.http.url_builder.invalid_port");p(this,he,String(t))}return this}},{key:"path",value:function(e){return p(this,fe,e),this}},{key:"build",value:function(){return new ce(v(this,le),v(this,ue),v(this,he),v(this,fe))}}]),n}();ne.url=function(){return new de};var ve="apc.controller",pe=k.getLogger(ve),ge={controllers:{}},ye=function(e){if("string"==typeof e){var t=ge.controllers[e];if(!t)throw Error("apice.controller.unknown_controller[".concat(e,"]"));return t}},me=new WeakMap,we=new WeakMap,be=new WeakSet,ke=new WeakSet,Ee=function(){function n(e,r){t(this,n),ke.add(this),be.add(this),me.set(this,{writable:!0,value:void 0}),we.set(this,{writable:!0,value:void 0}),p(this,me,e),p(this,we,r)}return r(n,[{key:"name",get:function(){return v(this,me)}},{key:"declare",value:function(e){if("function"!=typeof e)throw new Error("apice.controller.declare.invalid_implementation[".concat(v(this,me),"]"));p(this,we,e)}},{key:"serve",value:function(){var t=e(v(this,we));return"function"===t?y(this,be,Me).call(this):"string"===t?y(this,ke,We).call(this):Promise.reject(D.create({module:ve,code:"apice.controller.bad_implementation[".concat(v(this,me),"]")}))}}]),n}();function Me(){var e=this;return pe.debug("Serving controller. controller={0}",v(this,me)),new Promise((function(t,n){try{v(e,we).call(e),t()}catch(t){n(D.create({module:ve,cause:t,code:"apice.controller.serve.implementation_error[".concat(v(e,me),"]")}))}}))}function We(){var e=this;return pe.debug("Loading controller. controller={0}",v(this,me)),new Promise((function(t,n){ne.loadScript(v(e,we)).then((function(){setTimeout((function(){"string"==typeof v(e,we)?n("apice.controller.serve.undeclared[".concat(v(e,me),"]")):y(e,be,Me).call(e).then(t).catch(n)}),0)})).catch((function(t){n(D.create({module:ve,cause:t,code:"apice.controller.load_script_error[".concat(v(e,me),"]")}))}))}))}ye.register=function(e,t){pe.debug("Registering controller. controller={0)",e);var n=new Ee(e,t);return ge.controllers[e]=n,n},ye.declare=function(e,t){pe.debug("Declaring controller. controller={0}",e);var n=ge.controllers[e];if(!n)throw Error("apice.controller.declare.unknown_controller[".concat(e,"]"));n.declare(t)},ye.isController=function(e){return e&&e instanceof Ee};var _e="apice.fragment",Te=k.getLogger(_e),Se={fragments:{}},xe=new WeakMap,Ae=new WeakMap,Le=new WeakMap,Ce=new WeakSet,Re=function(){function e(n,r,i){t(this,e),Ce.add(this),xe.set(this,{writable:!0,value:void 0}),Ae.set(this,{writable:!0,value:void 0}),Le.set(this,{writable:!0,value:void 0}),p(this,xe,n),p(this,Ae,r),p(this,Le,i)}return r(e,[{key:"name",get:function(){return v(this,xe)}},{key:"render",value:function(e){var t=this;e||(e=document.body);var n=q(e);return n?(Te.debug("Serving fragment. fragment={0}",v(this,xe)),new Promise((function(e,r){ne.request(v(t,Ae),{method:"GET"}).then((function(i){n.content(i),y(t,Ce,Pe).call(t).then(e).catch(r)})).catch((function(e){r(D.create({module:_e,message:"An error has occurred trying to load the content",cause:e,code:"apice.fragment.render_error[".concat(t.name,"]")}))}))}))):Promise.reject(D.create({module:_e,code:"apice.fragment.render.target_not_found[".concat(e,"]")}))}}]),e}();function Pe(){var t=this;return v(this,Le)?new Promise((function(n,r){var i=e(v(t,Le));if("function"===i){Te.debug("Serving fragment controller function. fragment={0}",v(t,xe));try{v(t,Le).call(t),n()}catch(e){r(D.create({module:_e,cause:e,code:"apice.fragment.controller_function_error[".concat(v(t,xe),"]")}))}}else"string"===i&&(Te.debug("Serving fragment controller. fragment={0} controller={1}",v(t,xe),v(t,Le)),ye(v(t,Le)).serve().then(n).catch((function(e){r(D.create({module:_e,cause:e,code:"apice.fragment.controller_serve_error[".concat(t.name,"]")}))})))})):Promise.resolve()}var Ne=function(e){if("string"==typeof e){var t=Se.fragments[e];if(!t)throw new Error("apice.fragment.unknown_fragment[".concat(e,"]"));return t}};Ne.register=function(e,t,n){Te.debug("Registering fragment. fragment={0}",e);var r=new Re(e,t,n);return Se.fragments[e]=r,r},Ne.isFragment=function(e){return e&&e instanceof Re};var je="apice.router",Oe=k.getLogger(je),He={},Fe={};function Be(e){Oe.debug("Hash change triggered. event="+e);var t=He.hash(),n=He.match(t);if(n)Oe.debug("Serving route: "+n.pattern);else if(!Fe.defaultRoute||t&&Fe.notFoundRoute){if(!Fe.notFoundRoute)return void D.render({module:je,message:"The requested resource was not found: "+t,code:"apice.router.no_matching_no_default"});Oe.warn("Route not found. hash="+t+" route="+Fe.notFoundRoute.pattern),n=Fe.notFoundRoute}else t?Oe.warn("Route not found. Serving default hash="+t):Oe.debug("No hash found. Serving default router"),n=Fe.defaultRoute;n.serve()}Fe.routes=[],Fe.defaultRoute=null,Fe.notFoundRoute=null,Fe.target=null;var Ie=new WeakMap,qe=new WeakMap,ze=new WeakMap,Ue=new WeakSet,Xe=function(){function e(n){if(t(this,e),Ue.add(this),Ie.set(this,{writable:!0,value:void 0}),qe.set(this,{writable:!0,value:void 0}),ze.set(this,{writable:!0,value:void 0}),!n||"string"!=typeof n)throw Error("apice.router.hah.invalid_pattern");p(this,Ie,n),y(this,Ue,De).call(this)}return r(e,[{key:"pattern",get:function(){return v(this,Ie)}},{key:"count",get:function(){return v(this,qe).length}},{key:"hasParameters",get:function(){return v(this,ze).length>0}}]),e}();function De(){p(this,qe,[]),p(this,ze,[]);for(var e=v(this,Ie).split("/"),t=0;t<e.length;t++){var n=e[t];n.startsWith(":")&&v(this,ze).push(n.substr(1)),v(this,qe).push(n)}}var Ge=new WeakMap,$e=new WeakMap,Je=function(){function e(n,r){if(t(this,e),Ge.set(this,{writable:!0,value:void 0}),$e.set(this,{writable:!0,value:void 0}),!n||"string"!=typeof n)throw Error("apice.route.constructor.invalid_route_value");if(!r)throw Error("apice.route.constructor.missing_route_action");p(this,Ge,new Xe(n)),p(this,$e,r)}return r(e,[{key:"pattern",get:function(){return v(this,Ge).pattern}},{key:"asDefault",value:function(){Fe.defaultRoute=this}},{key:"asNotFound",value:function(){Fe.notFoundRoute=this}},{key:"match",value:function(e){return!v(this,Ge).hasParameters&&e===v(this,Ge).pattern}},{key:"serve",value:function(){try{if("function"==typeof v(this,$e))v(this,$e).call(this);else if("string"==typeof v(this,$e))Ne(v(this,$e)).render(Fe.target);else if(Ne.isFragment(v(this,$e)))v(this,$e).render(Fe.target);else{if("function"!=typeof v(this,$e).serve)throw Error("apice.router.invalid_action[".concat(this.pattern,"]"));v(this,$e).serve()}}catch(e){D.render({module:je,message:"An error has occurred trying to serve the resource. Please contact technical support without closing this screen",code:"apice.router.serve_error[".concat(this.pattern,"]"),cause:e},Fe.target)}}}]),e}();He.register=function(e,t){Oe.debug("Registering route. pattern="+e);var n=new Je(e,t);return Fe.routes.push(n),n},He.match=function(e){if(!e||"string"!=typeof e)return null;for(var t=0;t<Fe.routes.length;t++){var n=Fe.routes[t];if(!0===n.match(e))return n}return null},He.hash=function(){var e=window.location.hash;return e.startsWith("#")&&(e=e.substr(1)),e},He.start=function(){return Oe.debug("Starting Apice router"),A.addListener(window,"hashchange",(function(){Be("hashchange")})),A.documentReady((function(){Be("routerstart")})),He},He.target=function(){if(0===arguments.length)return Fe.target;var e=arguments[0];if(e?(Fe.target=q(e),Fe.target||Oe.error("apice.router.target_notfound[".concat(e,"]"))):Fe.target=null,!Fe.target){Oe.info("Using default routing target container");var t=document.getElementById("apc-router-container");t||((t=document.createElement("div")).id="apc-router-container",document.body.appendChild(t)),Fe.target=q(t)}return He};var Ve={},Ke={},Qe=k.getLogger("apice.ui.toast");function Ye(){var e=document.getElementById("apc-toast-container");return e||((e=document.createElement("div")).id="apc-toast-container",document.body.appendChild(e)),e}Ke.defaultTitle={},Ke.defaultTitle.error="Attention!",Ke.defaultTitle.warn="Warning!",Ke.defaultTitle.info="Information",Ke.defaultTitle.success="Sucess!";var Ze=new WeakMap,et=new WeakMap,tt=new WeakMap,nt=new WeakMap,rt=new WeakMap,it=new WeakMap,at=new WeakSet,ot=new WeakSet,st=new WeakSet,ct=new WeakSet,lt=function(){function e(n){t(this,e),ct.add(this),st.add(this),ot.add(this),at.add(this),Ze.set(this,{writable:!0,value:void 0}),et.set(this,{writable:!0,value:void 0}),tt.set(this,{writable:!0,value:void 0}),nt.set(this,{writable:!0,value:void 0}),rt.set(this,{writable:!0,value:void 0}),it.set(this,{writable:!0,value:void 0}),p(this,Ze,n.style),p(this,et,{text:n.title}),p(this,tt,{text:n.message}),p(this,nt,{resource:n.icon}),p(this,it,n.dismiss),y(this,ct,dt).call(this)}return r(e,[{key:"title",get:function(){return v(this,et).text||!1===v(this,et).text?v(this,et).text:Ke.defaultTitle[v(this,Ze)]}},{key:"message",get:function(){return v(this,tt).text}},{key:"dismiss",value:function(){var e=this;v(this,rt)&&(v(this,rt).style.animationName="bounce-out",setTimeout((function(){v(e,rt).parentElement.removeChild(v(e,rt)),p(e,rt,null)}),500))}},{key:"appendTo",value:function(e){e.insertBefore(v(this,rt),e.firstChild)}}]),e}();function ut(){var e=this.title;e?(v(this,et).box||(v(this,et).box=document.createElement("div"),v(this,et).box.className="apc-header",v(this,rt).appendChild(v(this,et).box)),v(this,et).box.style.display="block",v(this,et).box.innerHTML=e):v(this,et).box&&(v(this,et).box.style.display="none")}function ht(){v(this,tt).box||(v(this,tt).box=document.createElement("div"),v(this,tt).box.className="apc-body",v(this,rt).appendChild(v(this,tt).box)),v(this,tt).box.innerHTML=this.message}function ft(){v(this,nt).resource?(v(this,nt).box||(v(this,nt).box=document.createElement("div"),v(this,nt).box.className="apc-icon",v(this,rt).appendChild(v(this,nt).box)),!0===v(this,nt).resource&&(v(this,nt).box.innerHTML="&nbsp;")):v(this,nt).box&&(v(this,nt).box.style.display="none")}function dt(){var e=this;v(this,rt)||p(this,rt,document.createElement("div")),v(this,rt).className="apc-toast apc-"+v(this,Ze),y(this,st,ft).call(this),y(this,at,ut).call(this),y(this,ot,ht).call(this),"number"==typeof v(this,it)?setTimeout((function(){e.dismiss()}),1e3*v(this,it)):!0===v(this,it)&&(v(this,rt).onclick=function(){e.dismiss()},v(this,rt).className+=" apc-clickable")}function vt(t){var n,r={style:t,title:null,message:null,icon:!0,dismiss:!0};1==(arguments.length<=1?0:arguments.length-1)?"object"===e(arguments.length<=1?void 0:arguments[1])?Object.assign(r,arguments.length<=1?void 0:arguments[1]):r.message=arguments.length<=1?void 0:arguments[1]:(r.title=arguments.length<=1?void 0:arguments[1],r.message=arguments.length<=2?void 0:arguments[2],r.dismiss=null===(n=arguments.length<=3?void 0:arguments[3])||void 0===n||n);if(r.message){var i=new lt(r),a=Ye();i.appendTo(a)}else Qe.warn("A toast has been requested without message. The toast has been ignored")}Ve.error=function(){vt.apply(void 0,["error"].concat(Array.prototype.slice.call(arguments)))},Ve.warn=function(){vt.apply(void 0,["warn"].concat(Array.prototype.slice.call(arguments)))},Ve.info=function(){vt.apply(void 0,["info"].concat(Array.prototype.slice.call(arguments)))},Ve.success=function(){vt.apply(void 0,["success"].concat(Array.prototype.slice.call(arguments)))},Ve.setMax=function(){};var pt={},gt=k.getLogger("apice.ui.form");function yt(e){return"xs"===e.size?" apc-xs":"sm"===e.size?" apc-sm":e.size&&"md"!==e.size?"lg"===e.size?" apc-lg":" apc-xl":" apc-md"}function mt(e,t,n){var r=document.createElement("option");r.innerHTML=t,r.value=n,e.appendChild(r)}function wt(e,t){if(t)if("function"!=typeof t)t instanceof Promise?t.then((function(t){wt(e,t)})).catch((function(e){console.err(e)})):(Array.isArray(t)&&0!==t.length||(t=["No data"]),mt(e,"Please select...",""),t.map((function(t){mt(e,t.label,t.value)})));else{var n=t();wt(e,n)}}var bt=new WeakMap,kt=new WeakMap,Et=function(){function e(n,r){t(this,e),bt.set(this,{writable:!0,value:void 0}),kt.set(this,{writable:!0,value:void 0}),p(this,bt,document.createElement("div")),v(this,bt).className=n+yt({size:r}),v(this,bt).innerHTML="&nbsp;"}return r(e,[{key:"render",value:function(e){v(this,kt)||(p(this,kt,!0),e.appendChild(v(this,bt)))}}]),e}(),Mt=new WeakMap,Wt=new WeakMap,_t=new WeakMap,Tt=function(){function e(n){if(t(this,e),Mt.set(this,{writable:!0,value:void 0}),Wt.set(this,{writable:!0,value:void 0}),_t.set(this,{writable:!0,value:void 0}),!n)throw Error("apice.ui.form.button.null_specs");n.id||(n.id="btn_"+X.tinyId()),p(this,Mt,n.id),p(this,Wt,document.createElement("button")),v(this,Wt).id=n.id,v(this,Wt).className="apc-button",v(this,Wt).innerHTML=n.label,p(this,_t,!1)}return r(e,[{key:"click",value:function(e){0!==arguments.length?v(this,Wt).onclick="function"==typeof e?e:null:v(this,Wt).onclick&&v(this,Wt).onclick()}},{key:"render",value:function(e){v(this,_t)||(p(this,_t,!0),e.appendChild(v(this,Wt)))}}]),e}(),St=new WeakMap,xt=new WeakMap,At=new WeakMap,Lt=function(){function e(){t(this,e),St.set(this,{writable:!0,value:void 0}),xt.set(this,{writable:!0,value:void 0}),At.set(this,{writable:!0,value:void 0}),p(this,St,[]),p(this,xt,!1),p(this,At,document.createElement("div")),v(this,At).className="apc-button-bar"}return r(e,[{key:"addButton",value:function(e){if(e){var t=new Tt(e);return v(this,St).push(t),v(this,xt)&&t.render(),t}}},{key:"render",value:function(e){var t=this;v(this,xt)||(p(this,xt,!0),v(this,St).map((function(e){return e.render(v(t,At))})),e.appendChild(v(this,At)))}}]),e}(),Ct=new WeakMap,Rt=new WeakMap,Pt=new WeakMap,Nt=new WeakMap,jt=new WeakMap,Ot=new WeakMap,Ht=new WeakSet,Ft=new WeakSet,Bt=function(){function e(n){var r,i;t(this,e),Ft.add(this),Ht.add(this),Ct.set(this,{writable:!0,value:void 0}),Rt.set(this,{writable:!0,value:void 0}),Pt.set(this,{writable:!0,value:void 0}),Nt.set(this,{writable:!0,value:void 0}),jt.set(this,{writable:!0,value:void 0}),Ot.set(this,{writable:!0,value:void 0}),n.id||(n.id="field_"+X.tinyId()),n.type||(n.type="input"),p(this,Ct,n.id),p(this,Rt,n.type),p(this,Pt,n.label),p(this,Nt,document.createElement("div")),v(this,Nt).className=(i="apc-field","input"===(r=n).type?i+=" apc-text":"check"===r.type?i+=" apc-check":"select"===r.type&&(i+=" apc-select"),i+yt(r)),y(this,Ft,qt).call(this,n)}return r(e,[{key:"render",value:function(e){v(this,jt)&&v(this,Nt).appendChild(v(this,jt)),y(this,Ht,It).call(this),e.appendChild(v(this,Nt))}}]),e}();function It(){if(v(this,Pt)){var e=document.createElement("label");e.setAttribute("for",v(this,Ct)),e.className="apc-label",e.innerHTML=v(this,Pt),v(this,Nt).appendChild(e)}}function qt(e){"input"===v(this,Rt)?(p(this,jt,document.createElement("input")),v(this,jt).type="text"):"check"===v(this,Rt)?(p(this,jt,document.createElement("input")),v(this,jt).type="checkbox"):"select"===v(this,Rt)&&(p(this,jt,document.createElement("select")),wt(v(this,jt),e.source))}var zt=new WeakMap,Ut=new WeakMap,Xt=new WeakMap,Dt=new WeakMap,Gt=new WeakSet,$t=function(){function e(n){t(this,e),Gt.add(this),zt.set(this,{writable:!0,value:void 0}),Ut.set(this,{writable:!0,value:void 0}),Xt.set(this,{writable:!0,value:void 0}),Dt.set(this,{writable:!0,value:void 0}),p(this,zt,"form_"+X.tinyId()),p(this,Xt,[]),p(this,Ut,!1);var r=document.createElement("div");r.id=v(this,zt),r.className="apc-form",p(this,Dt,r),q(n).append(r)}return r(e,[{key:"addField",value:function(e){if(e){var t=new Bt(e);return y(this,Gt,Jt).call(this,t),t}}},{key:"addSpacer",value:function(e){var t=new Et("apc-spacer",e);y(this,Gt,Jt).call(this,t)}},{key:"addBreak",value:function(){var e=new Et("apc-break");y(this,Gt,Jt).call(this,e)}},{key:"addButtonBar",value:function(){var e=new Lt;return y(this,Gt,Jt).call(this,e),e}},{key:"addButton",value:function(e){if(e){var t=new Tt(e);return y(this,Gt,Jt).call(this,t),t}}},{key:"render",value:function(){var e=this;if(!v(this,Ut))return p(this,Ut,!0),v(this,Xt).map((function(t){return t.render(v(e,Dt))})),this}}]),e}();function Jt(e){e&&(v(this,Xt).push(e),v(this,Ut)&&e.render(v(this,Dt)))}function Vt(e){if(!e)return null;if("INPUT"===e.tagName&&"checkbox"===e.type){if(""===e.value||"on"===e.value)return e.checked;if(!e.checked)return null}return e.value}function Kt(e){var t=e.select("[collect]");if(!t)return gt.warn("apice.form.collect.no_collectable_fields"),{};var n={};return t.each((function(e){!function(e,t){var n=t.getAttribute("collect");if(n){n=n.split(".");for(var r=0;r<n.length;r++){var i=n[r];if(r<n.length-1)e[i]||(e[i]={}),e=e[i];else{var a=Vt(t);null!==a&&(e[i]=a)}}}}(n,e)})),n}pt.create=function(e){return new $t(e)},pt.collect=function(e){e||(e=document.body);var t=q(e);return t?Kt(t):(gt.warn("apice.form.collect.unknown_container[".concat(e,"]")),null)};var Qt={},Yt=k.getLogger("apice.ui.box");function Zt(e,t){var n=document.createElement("div");return n.className=e,t&&(n.id=t),n}function en(e,t){var n=Zt("apc-box",e.id);e.fullscreen?n.className+=" apc-full":Array.isArray(e.size)&&(n.className+=" apc-non-full",n.style.width=e.size[0],n.style.height=e.size[1]);var r=Zt("apc-box-content"),i={};return i.header=function(e,t){var n=Zt("apc-header");return n.style.display="none",t.appendChild(n),q(n)}(0,r),i.body=function(e){var t=Zt("apc-body");return t.innerHTML="BOX-CONTENT",e.appendChild(t),q(t)}(r),i.footer=function(e,t){var n=Zt("apc-footer");return n.innerHTML="BOX-FOOTER",n.style.display="none",t.appendChild(n),q(n)}(0,r),i.area=n,n.appendChild(r),e.closeable&&function(e,t){var n=Zt("apc-closing"),r=document.createElement("button");n.appendChild(r),e.appendChild(n),r.onclick=function(){t.close()}}(n,t),i}var tn=new WeakMap,nn=new WeakMap,rn=new WeakMap,an=new WeakMap,on=function(){function e(n){t(this,e),tn.set(this,{writable:!0,value:void 0}),nn.set(this,{writable:!0,value:void 0}),rn.set(this,{writable:!0,value:void 0}),an.set(this,{writable:!0,value:void 0}),n.id||(n.id="box-"+X.tinyId()),p(this,tn,n.id),Yt.info("Creating box. id={0}",n.id),p(this,an,-1),p(this,nn,en(n,this))}return r(e,[{key:"appendTo",value:function(e){return q.append(e,v(this,nn).area),p(this,rn,v(this,nn).area.parentElement),p(this,an,v(this,rn)?0:-1),this}},{key:"close",value:function(){return 1===v(this,an)&&(Yt.info("Closing box. id={0}",v(this,tn)),v(this,rn).removeChild(v(this,nn).area),p(this,an,0)),this}},{key:"open",value:function(){return 0===v(this,an)&&(v(this,rn).appendChild(v(this,nn).area),p(this,an,1)),this}},{key:"content",value:function(e){var t=this;return m.isPromise(e)?e.then((function(e){t.content(e)})).catch((function(e){t.close(),D.render(e)})):Ne.isFragment(e)?e.render(v(this,nn).body):v(this,nn).body.content(e),this}}]),e}();Qt.create=function(e){return e?"string"==typeof e&&(e={id:e}):e={},"boolean"!=typeof e.fullscreen&&(e.fullscreen=!1),"boolean"!=typeof e.closeable&&(e.closeable=!1),e.size||e.fullscreen||(e.size=["50%","50%"]),new on(e)};var sn={toast:Ve,form:pt,box:Qt},cn={};function ln(){return!0===arguments[0]?{major:cn.version.major,minor:cn.version.minor,patch:cn.version.patch}:"v"+cn.version.major+"."+cn.version.minor+"."+cn.version.patch}return cn.version={major:0,minor:1,patch:1},console.log("%cApice Framework ".concat(ln()),"color: #64dd17;"),{version:ln,ready:function(e){A.documentReady(e)},logging:k,util:m,events:A,element:q,cookies:b,http:ne,controller:ye,fragment:Ne,router:He,error:D,ui:sn,form:pt}}();
//# sourceMappingURL=apice.min.js.map
