var Apice=function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?s(e):t}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=o(e);if(t){var r=o(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return c(this,n)}}function u(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||h(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function f(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=h(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function p(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,g(e,t,"get"))}function v(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,g(e,t,"set"),n),n}function g(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function y(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var m={isPromise:function(e){return e instanceof Promise},trim:function(e){return e?e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""):""}},w=/\{(\d+)\}/g;m.placeholders=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var r={output:e,unbind:n};if("string"!=typeof e||!n||0===n.length)return r;var o,a={},s=e.matchAll(w),c=f(s);try{for(c.s();!(o=c.n()).done;){var l=o.value,u=l[1];if(u&&!a[u]){a[u]=!0;var h=new RegExp("\\{"+u+"\\}","g"),d=n[u];void 0!==d&&(r.unbind[u]=null,r.output=r.output.replace(h,d))}}}catch(e){c.e(e)}finally{c.f()}return r.unbind=r.unbind.filter((function(e){return null!=e})),r};var b={set:function(e,t,n){if(e){"number"!=typeof n&&(console.warn("Invalid timespan has been provided. Setting the default value"),n=3600);var i=new Date;i.setTime(i.getTime()+1e3*n);var r=m.trim(e)+"="+t+"; expires="+i.toGMTString()+"; path=/";document.cookie=r}else console.warn("Unable to set a cookie without name")},get:function(e){if(!e)return null;for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var i=m.trim(t[n]);if(i){var r=i.split("=");if(m.trim(r[0])===e)return r[1]}}return null}},k={},M={loggers:{},levels:{fatal:{value:10,color:"#ff4444",label:"FATAL"},error:{value:20,color:"#ff4444",label:"ERROR"},warn:{value:30,color:"#ff8800",label:"WARN"},info:{value:40,color:"#0099cc",label:"INFO"},debug:{value:50,color:"#3E4551",label:"DEBUG"},trace:{value:60,color:"#3E4551",label:"TRACE"}}},E=b.get("apice.logger.level");E?(M.globalLevel=M.levels[E],M.globalLevel||(M.globalLevel=M.levels.warn)):M.globalLevel=M.levels.warn;var W=new WeakMap,T=new WeakMap,_=new WeakSet,x=function(){function e(n){t(this,e),_.add(this),W.set(this,{writable:!0,value:void 0}),T.set(this,{writable:!0,value:void 0}),v(this,W,n);var i=b.get("apice.logger.["+n+"].level");i?(v(this,T,M.levels[i]),p(this,T)||v(this,T,M.globalLevel)):v(this,T,M.globalLevel)}return i(e,[{key:"name",get:function(){return p(this,W)}},{key:"level",value:function(){if(0!==arguments.length){var e=M.levels[arguments[0]];if(!e)throw new Error("apice.logger.invalid_level["+arguments[0]+"]");v(this,T,e),b.set("apice.logger.["+p(this,W)+"].level",arguments[0],1800)}return p(this,T).label}},{key:"fatal",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(t=y(this,_,S)).call.apply(t,[this,M.levels.fatal,e].concat(i))}},{key:"error",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(t=y(this,_,S)).call.apply(t,[this,M.levels.error,e].concat(i))}},{key:"warn",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(t=y(this,_,S)).call.apply(t,[this,M.levels.warn,e].concat(i))}},{key:"info",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(t=y(this,_,S)).call.apply(t,[this,M.levels.info,e].concat(i))}},{key:"debug",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(t=y(this,_,S)).call.apply(t,[this,M.levels.debug,e].concat(i))}},{key:"trace",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(t=y(this,_,S)).call.apply(t,[this,M.levels.trace,e].concat(i))}}]),e}();function S(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];if(p(this,T).value>=e.value){var o;if("string"!=typeof t)t=JSON.stringify(t);else if(i&&i.length>0){var a=m.placeholders.apply(m,[t].concat(u(i)));t=a.output,i=a.unbind}(o=console).log.apply(o,["%c["+e.label+"]["+p(this,W)+"]: "+t].concat(["color: "+e.color].concat(u(i))))}}function A(e,t,n){if(!e)throw new Error("apice.util.event.add.invalid_target");if(!t||"string"!=typeof t)throw new Error("apice.util.event.add.invalid_event_name");"function"==typeof n&&("function"==typeof e.each?e.each((function(e){A(e,t,n)})):"function"==typeof e.addEventListener?e.addEventListener(t,n,!1):"function"==typeof e.attachEvent&&e.attachEvent("on"+t,n))}function L(e,t,n){if(!e)throw new Error("apice.util.event.remove.invalid_target");if(!t||"string"!=typeof t)throw new Error("apice.util.event.remove.invalid_event_name");"function"==typeof n&&("function"==typeof e.each?e.each((function(e){L(e,t,n)})):"function"==typeof e.removeEventListener?e.removeEventListener(t,n):"function"==typeof e.detachEvent&&e.detachEvent("on"+t,n))}k.getLogger=function(e){return e||(e="system"),M.loggers[e]||(M.loggers[e]=new x(e)),M.loggers[e]},k.level=function(){var e;if(1===arguments.length){var t=M.levels[arguments[0]];if(!t)throw new Error("apice.logger.invalid_level["+arguments[0]+"]");for(var n in M.globalLevel=t,b.set("apice.logger.level",arguments[0],1800),M.loggers){var i=M.loggers[n];i.level(arguments[0])}}else if(2===arguments.length){var r=k.getLogger(arguments[1]);return r.level(arguments[0]),r.level()}return null===(e=M.globalLevel)||void 0===e?void 0:e.label};var C={addListener:A,removeListener:L,documentReady:function(e){"complete"===document.readyState?e():"function"==typeof document.addEventListener?document.addEventListener("DOMContentLoaded",e,!1):"function"==typeof document.attachEvent&&document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&e()}))},waitAnimation:function(e,t,n){A(e,"animationend",(function t(){L(e,"animationend",t),n()})),"function"==typeof e.setClass?e.setClass(t):e.className=t}},P={};function N(e){if(!e||"string"!=typeof e)return null;var t=document.createElement("div");return t.innerHTML=e,u(t.childNodes)}var R=function e(){t(this,e)},j=new WeakMap,q=new WeakMap,H=function(e){r(o,e);var n=l(o);function o(e){var i;return t(this,o),i=n.call(this),j.set(s(i),{writable:!0,value:void 0}),q.set(s(i),{writable:!0,value:void 0}),v(s(i),j,e),v(s(i),q,{}),i}return i(o,[{key:"isValid",get:function(){return!!p(this,j)}},{key:"id",get:function(){return p(this,j)?p(this,j).id:null}},{key:"each",value:function(e){return"function"==typeof e&&p(this,j)&&e(p(this,j)),this}},{key:"content",value:function(){var e=this;if(0===arguments.length)return p(this,j)?p(this,j).innerHTML:null;if(p(this,j)){var t=arguments[0];t?D(t)?(p(this,j).innerHTML="",p(this,j).appendChild(t)):t instanceof R?(p(this,j).innerHTML="",t.each((function(t){p(e,j).append(t)}))):p(this,j).innerHTML=t:p(this,j).innerHTML=""}return this}},{key:"append",value:function(){var e=this;if(p(this,j)&&arguments.length>0)if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.append(arguments[t]);else{var n=arguments[0];if(n instanceof R)n.each((function(t){p(e,j).appendChild(t)}));else if("string"==typeof n){n=N(n);for(var i=0;i<n.length;i++)p(this,j).appendChild(n[i])}else if(D(n))p(this,j).appendChild(n);else if(n instanceof NodeList)for(var r=0;r<n.length;r++){var o=n[r];p(this,j).appendChild(o)}}return this}},{key:"prepend",value:function(){var e=this;if(p(this,j)&&arguments.length>0)if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.prepend(arguments[t]);else{var n=p(this,j).firstChild,i=arguments[0];if(i instanceof R)i.each((function(t){p(e,j).insertBefore(t,n)}));else if("string"==typeof i){i=N(i);for(var r=0;r<i.length;r++)p(this,j).insertBefore(i[r],n)}else if(D(i))p(this,j).insertBefore(i,n);else if(i instanceof NodeList)for(var o=0;o<i.length;o++){var a=i[o];p(this,j).insertBefore(a,n)}}return this}},{key:"appendTo",value:function(e){(e=z(e))&&e.append(this)}},{key:"on",value:function(e,t){if(!e)throw new Error("apice.element.on.no_event_name");return p(this,j)&&"function"==typeof t&&C.addListener(p(this,j),e,t),this}},{key:"click",value:function(){return 0===arguments.length||"function"!=typeof arguments[0]||this.on("click",arguments[0]),this}},{key:"select",value:function(e){return e&&"string"==typeof e?U(p(this,j),e):null}},{key:"addClass",value:function(e){return e&&p(this,j).classList.add(e),this}},{key:"removeClass",value:function(e){return e&&p(this,j).classList.remove(e),this}},{key:"setClass",value:function(e){return e&&(p(this,j).className=e),this}},{key:"display",value:function(e){!0===e?p(this,q).originalDisplay?p(this,j).style.display=p(this,q).originalDisplay:p(this,j).style.display="block":(p(this,q).originalDisplay=p(this,j).style.display,p(this,j).style.display="none")}}]),o}(R),I=new WeakMap,O=new WeakSet,B=function(e){r(o,e);var n=l(o);function o(){var e;return t(this,o),e=n.call(this),O.add(s(e)),I.set(s(e),{writable:!0,value:void 0}),v(s(e),I,[]),e}return i(o,[{key:"add",value:function(e){return e&&p(this,I).push(e),this}},{key:"each",value:function(){return y(this,O,F).call(this,"each",arguments),this}},{key:"content",value:function(){return 0===arguments.length?y(this,O,F).call(this,"content",arguments):(y(this,O,F).call(this,"content",arguments),this)}},{key:"append",value:function(){return y(this,O,F).call(this,"append",arguments),this}},{key:"prepend",value:function(){return y(this,O,F).call(this,"prepend",arguments),this}},{key:"appendTo",value:function(){return y(this,O,F).call(this,"appendTo",arguments),this}},{key:"on",value:function(){return y(this,O,F).call(this,"on",arguments),this}},{key:"click",value:function(){return y(this,O,F).call(this,"click",arguments),this}},{key:"select",value:function(){return y(this,O,F).call(this,"select",arguments),this}},{key:"addClass",value:function(){return y(this,O,F).call(this,"addClass",arguments),this}},{key:"removeClass",value:function(){return y(this,O,F).call(this,"removeClass",arguments),this}},{key:"setClass",value:function(){return y(this,O,F).call(this,"setClass",arguments),this}},{key:"display",value:function(){return y(this,O,F).call(this,"display",arguments),this}}]),o}(R);function F(e,t){for(var n=[],i=0;i<p(this,I).length;i++){var r=p(this,I)[i],o=r[e];if("function"==typeof o)try{var a=o.apply(r,t);Array.isArray(a)?n.push.apply(n,u(a)):n.push(a)}catch(t){console.log("itaca.element.node_call[".concat(e,"]"),t)}}return n}function D(t){return t&&"object"===e(t)&&1===t.nodeType}function U(e,t){var n=e.querySelectorAll(t);if(0===n.length)return null;if(1===n.length)return new H(n[0]);for(var i=new B,r=0;r<n.length;r++){var o=n[r];i.add(new H(o))}return i}var z=function(e){return e?"body"===e||e===document.body?(P.bodySingleton||(P.bodySingleton=new H(document.body)),P.bodySingleton):"string"==typeof e?U(document,e):e instanceof R?e:D(e)?new H(e):null:null};function G(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function X(){return G()+G()}z.append=function(e,t){if(e&&t){if("body"===t||t===document.body)throw Error("apice.element.append.source_cannot_be_body");if("string"==typeof t){var n=t.charAt(0);if("#"===n||"."===n||"["===n){var i=document.querySelector(t);if(!i)throw Error("apice.element.append.unknown_source[".concat(t,"]"));t=i}}var r=z(e);if(!r)throw Error("apice.element.append.unknown_target[".concat(e,"]"));r.append(t)}},z.isApiceElement=function(e){return e&&e instanceof R};var J={tinyId:G,shortId:X,guid:function(){return X()+"-"+X()+"-"+X()+"-"+X()+X()}},$={},V={},K=k.getLogger("apice.ui.toast");function Q(){var e=document.getElementById("apc-toast-container");return e||((e=document.createElement("div")).id="apc-toast-container",document.body.appendChild(e)),e}V.defaultTitle={},V.defaultTitle.error="Attention!",V.defaultTitle.warn="Warning!",V.defaultTitle.info="Information",V.defaultTitle.success="Sucess!";var Y=new WeakMap,Z=new WeakMap,ee=new WeakMap,te=new WeakMap,ne=new WeakMap,ie=new WeakMap,re=new WeakSet,oe=new WeakSet,ae=new WeakSet,se=new WeakSet,ce=function(){function e(n){t(this,e),se.add(this),ae.add(this),oe.add(this),re.add(this),Y.set(this,{writable:!0,value:void 0}),Z.set(this,{writable:!0,value:void 0}),ee.set(this,{writable:!0,value:void 0}),te.set(this,{writable:!0,value:void 0}),ne.set(this,{writable:!0,value:void 0}),ie.set(this,{writable:!0,value:void 0}),v(this,Y,n.style),v(this,Z,{text:n.title}),v(this,ee,{text:n.message}),v(this,te,{resource:n.icon}),v(this,ie,n.dismiss),y(this,se,de).call(this)}return i(e,[{key:"title",get:function(){return p(this,Z).text||!1===p(this,Z).text?p(this,Z).text:V.defaultTitle[p(this,Y)]}},{key:"message",get:function(){return p(this,ee).text}},{key:"dismiss",value:function(){var e=this;p(this,ne)&&(p(this,ne).style.animationName="bounce-out",setTimeout((function(){p(e,ne).parentElement.removeChild(p(e,ne)),v(e,ne,null)}),500))}},{key:"appendTo",value:function(e){e.insertBefore(p(this,ne),e.firstChild)}}]),e}();function le(){var e=this.title;e?(p(this,Z).box||(p(this,Z).box=document.createElement("div"),p(this,Z).box.className="apc-header",p(this,ne).appendChild(p(this,Z).box)),p(this,Z).box.style.display="block",p(this,Z).box.innerHTML=e):p(this,Z).box&&(p(this,Z).box.style.display="none")}function ue(){p(this,ee).box||(p(this,ee).box=document.createElement("div"),p(this,ee).box.className="apc-body",p(this,ne).appendChild(p(this,ee).box)),p(this,ee).box.innerHTML=this.message}function he(){p(this,te).resource?(p(this,te).box||(p(this,te).box=document.createElement("div"),p(this,te).box.className="apc-icon",p(this,ne).appendChild(p(this,te).box)),!0===p(this,te).resource&&(p(this,te).box.innerHTML="&nbsp;")):p(this,te).box&&(p(this,te).box.style.display="none")}function de(){var e=this;p(this,ne)||v(this,ne,document.createElement("div")),p(this,ne).className="apc-toast apc-"+p(this,Y),y(this,ae,he).call(this),y(this,re,le).call(this),y(this,oe,ue).call(this),"number"==typeof p(this,ie)?setTimeout((function(){e.dismiss()}),1e3*p(this,ie)):!0===p(this,ie)&&(p(this,ne).onclick=function(){e.dismiss()},p(this,ne).className+=" apc-clickable")}function fe(t){var n,i={style:t,title:null,message:null,icon:!0,dismiss:!0};1==(arguments.length<=1?0:arguments.length-1)?"object"===e(arguments.length<=1?void 0:arguments[1])?Object.assign(i,arguments.length<=1?void 0:arguments[1]):i.message=arguments.length<=1?void 0:arguments[1]:(i.title=arguments.length<=1?void 0:arguments[1],i.message=arguments.length<=2?void 0:arguments[2],i.dismiss=null===(n=arguments.length<=3?void 0:arguments[3])||void 0===n||n);if(i.message){var r=new ce(i),o=Q();r.appendTo(o)}else K.warn("A toast has been requested without message. The toast has been ignored")}$.error=function(){fe.apply(void 0,["error"].concat(Array.prototype.slice.call(arguments)))},$.warn=function(){fe.apply(void 0,["warn"].concat(Array.prototype.slice.call(arguments)))},$.info=function(){fe.apply(void 0,["info"].concat(Array.prototype.slice.call(arguments)))},$.success=function(){fe.apply(void 0,["success"].concat(Array.prototype.slice.call(arguments)))},$.setMax=function(){};var pe={},ve=new WeakMap,ge=new WeakMap,ye=new WeakMap,me=new WeakMap,we=new WeakMap,be=new WeakMap,ke=new WeakSet,Me=function(){function e(n){t(this,e),ke.add(this),ve.set(this,{writable:!0,value:void 0}),ge.set(this,{writable:!0,value:void 0}),ye.set(this,{writable:!0,value:void 0}),me.set(this,{writable:!0,value:void 0}),we.set(this,{writable:!0,value:void 0}),be.set(this,{writable:!0,value:void 0}),v(this,we,J.guid()),v(this,ge,n.message),v(this,ye,n.cause),v(this,ve,n.module),v(this,me,n.code),v(this,be,!1)}return i(e,[{key:"guid",get:function(){return p(this,we)}},{key:"message",get:function(){var e;return null!==(e=p(this,ge))&&void 0!==e?e:"An error has occurred. Please contact the technical support without closing this screen."}},{key:"cause",get:function(){return p(this,ye)}},{key:"code",get:function(){return p(this,me)}},{key:"log",value:function(){var e=k.getLogger(p(this,ve)),t="ref=[".concat(p(this,we),"]");p(this,ge)&&(t+="\n-> ".concat(p(this,ge))),p(this,me)&&(t+="\n-> (c) ".concat(p(this,me))),p(this,ye)&&(t+=y(this,ke,Ee).call(this,p(this,ye))),e.error(t)}},{key:"render",value:function(e){if(!p(this,be)){v(this,be,!0),this.log();var t=z(e);t?t.content('<div class="apc-badge apc-error">            <div class="apc-header">Atention!</div>            <div class="apc-body">'.concat(this.message,'</div>            <div class="apc-footer">').concat(p(this,we),"</div>        </div>")):$.error("".concat(this.message,"<div>").concat(p(this,we),"</div>"))}}}]),e}();function Ee(e){return e?"string"==typeof e?"\n-> (s) ".concat(e):e instanceof Error?"\n-> (e) ".concat(e.stack):p(this,ye)instanceof Me?"\n-> (n) ".concat(e.code)+y(this,ke,Ee).call(this,e.cause):p(this,ye)instanceof Te?"\n-> (h) http-error[".concat(e.code,"]"):void 0:""}pe.create=function(t){if(!t)return console.error("apice.error_handler.create.null_input"),null;var n=e(t);if("string"===n)t={code:t};else if(t instanceof Error)t={cause:t};else if("object"!==n)return console.error("apice.error_handler.create.invalid_input",t),null;return new Me(t)},pe.render=function(e,t){if(e)return e instanceof Me||(e=pe.create(e)),e.render(t),e};var We=new WeakMap,Te=function(){function e(n){t(this,e),We.set(this,{writable:!0,value:void 0}),v(this,We,n)}return i(e,[{key:"type",get:function(){return"http"}},{key:"code",get:function(){return p(this,We)}}]),e}();pe.createHttpError=function(e){return new Te(e)},window.addEventListener("unhandledrejection",(function(e){e.reason instanceof Me&&(e.preventDefault(),e.reason.render())}));var _e={},xe=k.getLogger("apice.http");function Se(e,t,n){var i=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){throw Error("apice.http.xmlhttp_creation_error")}}}();return i.guid=J.shortId(),i.onreadystatechange=function(){if(4==i.readyState||"complete"===i.readyState)if(200==i.status){xe.trace("Successful HTTP response received. request={0}",i.guid);var r={};r.headers=function(e){var t={},n=e.getAllResponseHeaders();if(n){n=n.split("\r\n");for(var i=0;i<n.length;i++){var r=n[i].split(":");t[m.trim(r[0]).toLowerCase()]=m.trim(r[1])}}return t}(i),r.content=i.responseText,function(e,t,n,i){if("json"===i.output||!i.output&&"application/json"===t["content-type"])try{t.content=JSON.parse(t.content)}catch(i){xe.error("An error occurred parsing a HTTP JSON content. request={0}\r\nContent:\r\n{1}\r\n",e.guid,t.content,i),n(pe.create({code:"apice.http.json_parse_error",cause:i}))}}(i,r,t,n),e(r)}else xe.trace("Failed HTTP response. request={0} status={1}",i.guid,i.status),t(pe.createHttpError(i.status))},i}_e.request=function(e,t){return"string"==typeof e&&e?(t||(t={}),t.method||(t.method="GET"),new Promise((function(n,i){var r=Se(n,i,t);xe.debug("Triggering http request. request={0} url={1}",r.guid,e),r.open(t.method,e,!1!==t.async),"GET"!==t.method&&t.data?r.send(t.data):r.send()}))):(xe.error("Unable to execute an HTTP request without an URL"),Promise.reject("apice.http.null_url"))},_e.loadScript=function(e){return new Promise((function(t,n){var i=document.createElement("script");i.src=e,i.type="text/javascript",i.async=!1,i.onerror=function(){n(pe.create({module:"apice.http",code:"apice.http.load_script_error[".concat(e,"]")}))},i.onload=function(){t()},document.head.appendChild(i)}))};var Ae=new WeakMap,Le=new WeakMap,Ce=new WeakMap,Pe=new WeakMap,Ne=function(){function e(n,i,r,o){if(t(this,e),Ae.set(this,{writable:!0,value:void 0}),Le.set(this,{writable:!0,value:void 0}),Ce.set(this,{writable:!0,value:void 0}),Pe.set(this,{writable:!0,value:void 0}),!p(this,Le))throw new Error("apice.http.url.no_host");v(this,Ae,null!=n?n:"https"),v(this,Le,i),v(this,Ce,null!=r?r:"80"),v(this,Pe,null!=o?o:"")}return i(e,[{key:"protocol",get:function(){return p(this,Ae)}},{key:"host",get:function(){return p(this,Le)}},{key:"port",get:function(){return p(this,Ce)}},{key:"path",get:function(){return p(this,Pe)}},{key:"toString",value:function(){return p(this,Ae)+"://"+p(this,Le)+":"+p(this,Ce)+"/"+p(this,Pe)}},{key:"resourceUrl",value:function(e,t,n){var i=this.toString();return e&&"string"==typeof e&&(i.endsWith("/")||e.startsWith("/")||(i+="/"),i+=e),t&&"string"==typeof t&&(t.startsWith("?")||(i+="?"),i+=t),n&&"string"==typeof n&&(n.startsWith("#")||(i+="#"),i+=n),i}},{key:"get",value:function(e,t,n){var i=this.resourceUrl(e,t,n);return _e.request(i,{method:"GET"})}},{key:"post",value:function(e,t){var n=this.resourceUrl(e);return _e.request(n,{method:"POST",data:t})}},{key:"put",value:function(e,t){var n=this.resourceUrl(e);return _e.request(n,{method:"PUT",data:t})}},{key:"delete",value:function(e,t){var n=this.resourceUrl(e);return _e.request(n,{method:"DELETE",data:t})}}]),e}(),Re=new WeakMap,je=new WeakMap,qe=new WeakMap,He=new WeakMap,Ie=function(){function n(){t(this,n),Re.set(this,{writable:!0,value:void 0}),je.set(this,{writable:!0,value:void 0}),qe.set(this,{writable:!0,value:void 0}),He.set(this,{writable:!0,value:void 0})}return i(n,[{key:"protocol",value:function(e){return v(this,Re,e),this}},{key:"host",value:function(e){return v(this,je,e),this}},{key:"port",value:function(t){var n=e(t);if("string"===n)v(this,qe,t);else{if("number"!==n)throw new Error("apice.http.url_builder.invalid_port");v(this,qe,String(t))}return this}},{key:"path",value:function(e){return v(this,He,e),this}},{key:"build",value:function(){return new Ne(p(this,Re),p(this,je),p(this,qe),p(this,He))}}]),n}();_e.url=function(){return new Ie};var Oe="apc.controller",Be=k.getLogger(Oe),Fe={controllers:{}},De=function(e){if("string"==typeof e){var t=Fe.controllers[e];if(!t)throw Error("apice.controller.unknown_controller[".concat(e,"]"));return t}},Ue=new WeakMap,ze=new WeakMap,Ge=new WeakSet,Xe=new WeakSet,Je=function(){function n(e,i){t(this,n),Xe.add(this),Ge.add(this),Ue.set(this,{writable:!0,value:void 0}),ze.set(this,{writable:!0,value:void 0}),v(this,Ue,e),v(this,ze,i)}return i(n,[{key:"name",get:function(){return p(this,Ue)}},{key:"declare",value:function(e){if("function"!=typeof e)throw new Error("apice.controller.declare.invalid_implementation[".concat(p(this,Ue),"]"));v(this,ze,e)}},{key:"serve",value:function(){var t=e(p(this,ze));return"function"===t?y(this,Ge,$e).call(this):"string"===t?y(this,Xe,Ve).call(this):Promise.reject(pe.create({module:Oe,code:"apice.controller.bad_implementation[".concat(p(this,Ue),"]")}))}}]),n}();function $e(){var e=this;return Be.debug("Serving controller. controller={0}",p(this,Ue)),new Promise((function(t,n){try{p(e,ze).call(e),t()}catch(t){n(pe.create({module:Oe,cause:t,code:"apice.controller.serve.implementation_error[".concat(p(e,Ue),"]")}))}}))}function Ve(){var e=this;return Be.debug("Loading controller. controller={0}",p(this,Ue)),new Promise((function(t,n){_e.loadScript(p(e,ze)).then((function(){setTimeout((function(){"string"==typeof p(e,ze)?n("apice.controller.serve.undeclared[".concat(p(e,Ue),"]")):y(e,Ge,$e).call(e).then(t).catch(n)}),0)})).catch((function(t){n(pe.create({module:Oe,cause:t,code:"apice.controller.load_script_error[".concat(p(e,Ue),"]")}))}))}))}De.register=function(e,t){Be.debug("Registering controller. controller={0)",e);var n=new Je(e,t);return Fe.controllers[e]=n,n},De.declare=function(e,t){Be.debug("Declaring controller. controller={0}",e);var n=Fe.controllers[e];if(!n)throw Error("apice.controller.declare.unknown_controller[".concat(e,"]"));n.declare(t)},De.isController=function(e){return e&&e instanceof Je};var Ke="apice.fragment",Qe=k.getLogger(Ke),Ye={fragments:{}},Ze=new WeakMap,et=new WeakMap,tt=new WeakMap,nt=new WeakSet,it=function(){function e(n,i,r){t(this,e),nt.add(this),Ze.set(this,{writable:!0,value:void 0}),et.set(this,{writable:!0,value:void 0}),tt.set(this,{writable:!0,value:void 0}),v(this,Ze,n),v(this,et,i),v(this,tt,r)}return i(e,[{key:"name",get:function(){return p(this,Ze)}},{key:"render",value:function(e){var t=this;e||(e=document.body);var n=z(e);return n?(Qe.debug("Serving fragment. fragment={0}",p(this,Ze)),new Promise((function(e,i){_e.request(p(t,et),{method:"GET"}).then((function(r){n.content(r.content),setTimeout((function(){y(t,nt,rt).call(t).then(e).catch(i)}),0)})).catch((function(e){i(pe.create({module:Ke,message:"An error has occurred trying to load the content",cause:e,code:"apice.fragment.render_error[".concat(t.name,"]")}))}))}))):Promise.reject(pe.create({module:Ke,code:"apice.fragment.render.target_not_found[".concat(e,"]")}))}}]),e}();function rt(){var t=this;return p(this,tt)?new Promise((function(n,i){var r=e(p(t,tt));if("function"===r){Qe.debug("Serving fragment controller function. fragment={0}",p(t,Ze));try{p(t,tt).call(t),n()}catch(e){i(pe.create({module:Ke,cause:e,code:"apice.fragment.controller_function_error[".concat(p(t,Ze),"]")}))}}else"string"===r&&(Qe.debug("Serving fragment controller. fragment={0} controller={1}",p(t,Ze),p(t,tt)),De(p(t,tt)).serve().then(n).catch((function(e){i(pe.create({module:Ke,cause:e,code:"apice.fragment.controller_serve_error[".concat(t.name,"]")}))})))})):Promise.resolve()}var ot=function(e){if("string"==typeof e){var t=Ye.fragments[e];if(!t)throw new Error("apice.fragment.unknown_fragment[".concat(e,"]"));return t}};ot.register=function(e,t,n){Qe.debug("Registering fragment. fragment={0}",e);var i=new it(e,t,n);return Ye.fragments[e]=i,i},ot.isFragment=function(e){return e&&e instanceof it};var at="apice.router",st=k.getLogger(at),ct={},lt={};function ut(e){st.debug("Hash change triggered. event={0}",e);var t=ct.hash(),n=ct.match(t);if(n)st.debug("Serving route. pattern={0}",n.pattern);else if(!lt.defaultRoute||t&&lt.notFoundRoute){if(!lt.notFoundRoute)return void pe.render({module:at,message:"The requested resource was not found: "+t,code:"apice.router.no_matching_no_default"});st.warn("Route not found. Using no-found default routing. hash={0}",t),n=lt.notFoundRoute}else t?st.warn("Route not found. Serving default hash={0}",t):st.debug("No hash found. Serving default router"),n=lt.defaultRoute;n.serve(t)}lt.routes=[],lt.defaultRoute=null,lt.notFoundRoute=null,lt.target=null;var ht=new WeakMap,dt=new WeakMap,ft=new WeakMap,pt=new WeakSet,vt=function(){function e(n){if(t(this,e),pt.add(this),ht.set(this,{writable:!0,value:void 0}),dt.set(this,{writable:!0,value:void 0}),ft.set(this,{writable:!0,value:void 0}),!n||"string"!=typeof n)throw Error("apice.router.hah.invalid_pattern");v(this,ht,n),y(this,pt,gt).call(this)}return i(e,[{key:"pattern",get:function(){return p(this,ht)}},{key:"count",get:function(){return p(this,dt).length}},{key:"hasParameters",get:function(){return p(this,ft).length>0}}]),e}();function gt(){v(this,dt,[]),v(this,ft,[]);for(var e=p(this,ht).split("/"),t=0;t<e.length;t++){var n=e[t];n.startsWith(":")&&p(this,ft).push(n.substr(1)),p(this,dt).push(n)}}var yt=new WeakMap,mt=new WeakMap,wt=function(){function e(n,i){if(t(this,e),yt.set(this,{writable:!0,value:void 0}),mt.set(this,{writable:!0,value:void 0}),!n||"string"!=typeof n)throw Error("apice.route.constructor.invalid_route_value");if(!i)throw Error("apice.route.constructor.missing_route_action");v(this,yt,new vt(n)),v(this,mt,i)}return i(e,[{key:"pattern",get:function(){return p(this,yt).pattern}},{key:"asDefault",value:function(){lt.defaultRoute=this}},{key:"asNotFound",value:function(){lt.notFoundRoute=this}},{key:"match",value:function(e){return!p(this,yt).hasParameters&&e===p(this,yt).pattern}},{key:"serve",value:function(e){try{if("function"==typeof p(this,mt))st.trace("Serving routing from function. pattern={0}",this.pattern),p(this,mt).call(this,e);else if("string"==typeof p(this,mt))st.trace("Serving routing from fragment ID. pattern={0} fragment={1}",this.pattern,p(this,mt)),ot(p(this,mt)).render(lt.target);else if(ot.isFragment(p(this,mt)))st.trace("Serving routing from fragment instance. pattern={0}",this.pattern),p(this,mt).render(lt.target);else{if("function"!=typeof p(this,mt).serve)throw Error("apice.router.invalid_action[".concat(this.pattern,"]"));st.trace("Serving routing from serviced instance. pattern={0}",this.pattern),p(this,mt).serve()}}catch(e){pe.render({module:at,message:"An error has occurred trying to serve the resource. Please contact technical support without closing this screen",code:"apice.router.serve_error[".concat(this.pattern,"]"),cause:e},lt.target)}}}]),e}();ct.register=function(e,t){st.debug("Registering route. pattern="+e);var n=new wt(e,t);return lt.routes.push(n),n},ct.match=function(e){if(!e||"string"!=typeof e)return null;for(var t=0;t<lt.routes.length;t++){var n=lt.routes[t];if(!0===n.match(e))return n}return null},ct.hash=function(){var e=window.location.hash;return e.startsWith("#")&&(e=e.substr(1)),e},ct.start=function(){return st.debug("Starting Apice router"),C.addListener(window,"hashchange",(function(){ut("hashchange")})),C.documentReady((function(){ut("routerstart")})),ct},ct.target=function(){if(0===arguments.length)return lt.target;var e=arguments[0];if(e?(lt.target=z(e),lt.target||st.error("apice.router.target_notfound[".concat(e,"]"))):lt.target=null,!lt.target){st.info("Using default routing target container");var t=document.getElementById("apc-router-container");t||((t=document.createElement("div")).id="apc-router-container",document.body.appendChild(t)),lt.target=z(t)}return ct};var bt={},kt=k.getLogger("apice.ui.form");function Mt(e){return"xs"===e.size?" apc-xs":"sm"===e.size?" apc-sm":e.size&&"md"!==e.size?"lg"===e.size?" apc-lg":" apc-xl":" apc-md"}function Et(e,t,n){var i=document.createElement("option");i.innerHTML=t,i.value=n,e.appendChild(i)}function Wt(e,t){if(t)if("function"!=typeof t)t instanceof Promise?t.then((function(t){Wt(e,t)})).catch((function(e){console.err(e)})):(Array.isArray(t)&&0!==t.length||(t=["No data"]),Et(e,"Please select...",""),t.map((function(t){Et(e,t.label,t.value)})));else{var n=t();Wt(e,n)}}var Tt=new WeakMap,_t=new WeakMap,xt=function(){function e(n,i){t(this,e),Tt.set(this,{writable:!0,value:void 0}),_t.set(this,{writable:!0,value:void 0}),v(this,Tt,document.createElement("div")),p(this,Tt).className=n+Mt({size:i}),p(this,Tt).innerHTML="&nbsp;"}return i(e,[{key:"render",value:function(e){p(this,_t)||(v(this,_t,!0),e.appendChild(p(this,Tt)))}}]),e}(),St=new WeakMap,At=new WeakMap,Lt=new WeakMap,Ct=function(){function e(n){if(t(this,e),St.set(this,{writable:!0,value:void 0}),At.set(this,{writable:!0,value:void 0}),Lt.set(this,{writable:!0,value:void 0}),!n)throw Error("apice.ui.form.button.null_specs");n.id||(n.id="btn_"+J.tinyId()),v(this,St,n.id),v(this,At,document.createElement("button")),p(this,At).id=n.id,p(this,At).className="apc-button",p(this,At).innerHTML=n.label,v(this,Lt,!1)}return i(e,[{key:"click",value:function(e){0!==arguments.length?p(this,At).onclick="function"==typeof e?e:null:p(this,At).onclick&&p(this,At).onclick()}},{key:"render",value:function(e){p(this,Lt)||(v(this,Lt,!0),e.appendChild(p(this,At)))}}]),e}(),Pt=new WeakMap,Nt=new WeakMap,Rt=new WeakMap,jt=function(){function e(){t(this,e),Pt.set(this,{writable:!0,value:void 0}),Nt.set(this,{writable:!0,value:void 0}),Rt.set(this,{writable:!0,value:void 0}),v(this,Pt,[]),v(this,Nt,!1),v(this,Rt,document.createElement("div")),p(this,Rt).className="apc-button-bar"}return i(e,[{key:"addButton",value:function(e){if(e){var t=new Ct(e);return p(this,Pt).push(t),p(this,Nt)&&t.render(),t}}},{key:"render",value:function(e){var t=this;p(this,Nt)||(v(this,Nt,!0),p(this,Pt).map((function(e){return e.render(p(t,Rt))})),e.appendChild(p(this,Rt)))}}]),e}(),qt=new WeakMap,Ht=new WeakMap,It=new WeakMap,Ot=new WeakMap,Bt=new WeakMap,Ft=new WeakMap,Dt=new WeakSet,Ut=new WeakSet,zt=function(){function e(n){var i,r;t(this,e),Ut.add(this),Dt.add(this),qt.set(this,{writable:!0,value:void 0}),Ht.set(this,{writable:!0,value:void 0}),It.set(this,{writable:!0,value:void 0}),Ot.set(this,{writable:!0,value:void 0}),Bt.set(this,{writable:!0,value:void 0}),Ft.set(this,{writable:!0,value:void 0}),n.id||(n.id="field_"+J.tinyId()),n.type||(n.type="input"),v(this,qt,n.id),v(this,Ht,n.type),v(this,It,n.label),v(this,Ot,document.createElement("div")),p(this,Ot).className=(r="apc-field","input"===(i=n).type?r+=" apc-text":"check"===i.type?r+=" apc-check":"select"===i.type&&(r+=" apc-select"),r+Mt(i)),y(this,Ut,Xt).call(this,n)}return i(e,[{key:"render",value:function(e){p(this,Bt)&&p(this,Ot).appendChild(p(this,Bt)),y(this,Dt,Gt).call(this),e.appendChild(p(this,Ot))}}]),e}();function Gt(){if(p(this,It)){var e=document.createElement("label");e.setAttribute("for",p(this,qt)),e.className="apc-label",e.innerHTML=p(this,It),p(this,Ot).appendChild(e)}}function Xt(e){"input"===p(this,Ht)?(v(this,Bt,document.createElement("input")),p(this,Bt).type="text"):"check"===p(this,Ht)?(v(this,Bt,document.createElement("input")),p(this,Bt).type="checkbox"):"select"===p(this,Ht)&&(v(this,Bt,document.createElement("select")),Wt(p(this,Bt),e.source))}var Jt=new WeakMap,$t=new WeakMap,Vt=new WeakMap,Kt=new WeakMap,Qt=new WeakSet,Yt=function(){function e(n){t(this,e),Qt.add(this),Jt.set(this,{writable:!0,value:void 0}),$t.set(this,{writable:!0,value:void 0}),Vt.set(this,{writable:!0,value:void 0}),Kt.set(this,{writable:!0,value:void 0}),v(this,Jt,"form_"+J.tinyId()),v(this,Vt,[]),v(this,$t,!1);var i=document.createElement("div");i.id=p(this,Jt),i.className="apc-form",v(this,Kt,i),z(n).append(i)}return i(e,[{key:"addField",value:function(e){if(e){var t=new zt(e);return y(this,Qt,Zt).call(this,t),t}}},{key:"addSpacer",value:function(e){var t=new xt("apc-spacer",e);y(this,Qt,Zt).call(this,t)}},{key:"addBreak",value:function(){var e=new xt("apc-break");y(this,Qt,Zt).call(this,e)}},{key:"addButtonBar",value:function(){var e=new jt;return y(this,Qt,Zt).call(this,e),e}},{key:"addButton",value:function(e){if(e){var t=new Ct(e);return y(this,Qt,Zt).call(this,t),t}}},{key:"render",value:function(){var e=this;if(!p(this,$t))return v(this,$t,!0),p(this,Vt).map((function(t){return t.render(p(e,Kt))})),this}}]),e}();function Zt(e){e&&(p(this,Vt).push(e),p(this,$t)&&e.render(p(this,Kt)))}function en(e){if(!e)return null;if("INPUT"===e.tagName&&"checkbox"===e.type){if(""===e.value||"on"===e.value)return e.checked;if(!e.checked)return null}return e.value}function tn(e){var t=e.select("[collect]");if(!t)return kt.warn("apice.form.collect.no_collectable_fields"),{};var n={};return t.each((function(e){!function(e,t){var n=t.getAttribute("collect");if(n){n=n.split(".");for(var i=0;i<n.length;i++){var r=n[i];if(i<n.length-1)e[r]||(e[r]={}),e=e[r];else{var o=en(t);null!==o&&(e[r]=o)}}}}(n,e)})),n}bt.create=function(e){return new Yt(e)},bt.collect=function(e){e||(e=document.body);var t=z(e);return t?tn(t):(kt.warn("apice.form.collect.unknown_container[".concat(e,"]")),null)};var nn={},rn=k.getLogger("apice.async");nn.defer=function(){var e={},t=new Promise((function(t,n){e.resolve=t,e.reject=n}));return t.resolve=e.resolve,t.reject=e.reject,t};var on=new WeakMap,an=new WeakMap,sn=new WeakMap,cn=new WeakMap,ln=new WeakMap,un=function(){function e(){var n=this;t(this,e),on.set(this,{writable:!0,value:void 0}),an.set(this,{writable:!0,value:void 0}),sn.set(this,{writable:!0,value:void 0}),cn.set(this,{writable:!0,value:void 0}),ln.set(this,{writable:!0,value:void 0}),v(this,on,"semaphore_"+J.shortId()),rn.debug("Semaphore created. semaphore={0}",p(this,on)),v(this,an,{binded:0,resolved:0,failed:0}),v(this,sn,new Promise((function(e,t){v(n,cn,e),v(n,ln,t)})))}return i(e,[{key:"wait",value:function(e){var t=this;if(e)return p(this,an).binded++,e.semaphore=J.shortId(),rn.debug("Adding new promise. semaphore={0} promise={1}",p(this,on),e.semaphore),e.then((function(){rn.debug("Semaphore promise resolved. semaphore={0} promise={1}",p(t,on),e.semaphore),p(t,an).resolved++,p(t,an).binded===p(t,an).resolved&&setTimeout((function(){p(t,cn).call(t)}),0)})).catch((function(n){throw rn.debug("Semaphore promise rejected. semaphore={0} promise={1}",p(t,on),e.semaphore),p(t,an).failed++,setTimeout((function(){p(t,ln).call(t,n)}),0),n}));rn.warn("Semaphore wait has been invoked without providing a promise. semaphore={0}",p(this,on))}},{key:"then",value:function(e){return rn.debug("Registering then-callback. semaphore={0}",p(this,on)),p(this,sn).then(e)}},{key:"catch",value:function(e){return rn.debug("Registering catch-callback. semaphore={0}",p(this,on)),p(this,sn).catch(e)}},{key:"isBinded",value:function(){return p(this,an).binded>0}},{key:"isCompleted",value:function(){return this.isBinded()&&p(this,an).resolved+p(this,an).failed===p(this,an).binded}},{key:"isResolved",value:function(){return this.isCompleted()&&p(this,an).resolved===p(this,an).binded}},{key:"isFailed",value:function(){return this.isBinded()&&p(this,an).failed>0}}]),e}();nn.semaphore=function(){return new un};var hn={},dn=k.getLogger("apice.ui.box");function fn(e,t){var n=document.createElement("div");return n.className=e,t&&(n.id=t),n}function pn(e,t){var n,i,r={},o=fn("apc-box-content");return r.header=(n=o,(i=fn("apc-header")).style.display="none",n.appendChild(i),z(i)),r.body=function(e){var t=fn("apc-body");return e.appendChild(t),z(t)}(o),r.footer=function(e,t){var n=fn("apc-footer");return n.style.display="none",t.appendChild(n),z(n)}(0,o),r.box=fn("apc-box",e.id),e.fullscreen?r.box.className+=" apc-full":Array.isArray(e.size)&&(r.box.className+=" apc-non-full",r.box.style.width=e.size[0],r.box.style.height=e.size[1]),r.box.appendChild(o),e.closeable&&function(e,t){var n=fn("apc-closing"),i=document.createElement("button");n.appendChild(i),e.appendChild(n),i.onclick=function(){t.close()}}(r.box,t),r}var vn=new WeakMap,gn=new WeakMap,yn=new WeakMap,mn=new WeakMap,wn=function(){function e(n){t(this,e),vn.set(this,{writable:!0,value:void 0}),gn.set(this,{writable:!0,value:void 0}),yn.set(this,{writable:!0,value:void 0}),mn.set(this,{writable:!0,value:void 0}),n.id||(n.id="box-"+J.tinyId()),v(this,vn,n.id),dn.info("Creating box. id={0}",n.id),v(this,yn,-1),v(this,gn,pn(n,this)),v(this,mn,nn.semaphore())}return i(e,[{key:"id",get:function(){return p(this,vn)}},{key:"appendTo",value:function(e){return z.append(e,p(this,gn).box),-1===p(this,yn)&&v(this,yn,0),this}},{key:"close",value:function(){return dn.info("Closing box. id={0}",p(this,vn)),v(this,yn,0),p(this,gn).box.style.display="none",this}},{key:"open",value:function(e){var t=this;return new Promise((function(n,i){e&&p(t,mn).wait(t.content(e)),-1===!p(t,yn)&&t.appendTo(document.body),p(t,mn).then((function(){v(t,yn,1),p(t,gn).box.style.display="block",setTimeout((function(){n()}),0)})).catch((function(e){i(e)}))}))}},{key:"content",value:function(e){var t=this;return m.isPromise(e)?(dn.debug("A promise content has been received for a box. id={0}",p(this,vn)),p(this,mn).wait(e.then((function(e){dn.debug("Content promise fulfilled for a box. id={0}",p(t,vn)),p(t,mn).wait(t.content(e))})).catch((function(e){throw dn.error("An error has occurred fulfilling a box content promise. id={0}",p(t,vn),e),pe.render(e,p(t,gn).body)})))):ot.isFragment(e)?(dn.debug("A fragment content has been received for a box. id={0}",p(this,vn)),p(this,mn).wait(e.render(p(this,gn).body))):(dn.debug("A raw content has been received for a box. id={0}",p(this,vn)),p(this,gn).body.content(e),p(this,mn).wait(Promise.resolve()))}}]),e}();hn.create=function(e){return e?"string"==typeof e&&(e={id:e}):e={},"boolean"!=typeof e.fullscreen&&(e.fullscreen=!1),"boolean"!=typeof e.closeable&&(e.closeable=!1),e.size||e.fullscreen||(e.size=["50%","50%"]),new wn(e)};var bn={},kn=k.getLogger("apice.ui.mask");bn.show=function(){return kn.trace("Showing protective mask"),new Promise((function(e){var t=document.getElementById("apice-mask");t||((t=document.createElement("div")).id="apice-mask",t.className="apc-mask",document.body.appendChild(t)),t.style.display="block",C.waitAnimation(t,"apc-mask apc-open",e)}))},bn.hide=function(){return kn.trace("Hidding protective mask"),new Promise((function(e){var t=document.getElementById("apice-mask");t&&C.waitAnimation(t,"apc-mask apc-closed",(function(){t.style.display="none",e()}))}))};var Mn={},En=k.getLogger("apice.ui.dialog"),Wn={};function Tn(e,t){var n=document.createElement("div");return n.className=t,e.append(n),z(n)}function _n(e,t){if(1===Wn.status)return En.debug("Dialog container is already visible"),Promise.resolve();Wn.status=1,function(){if(!Wn.container){En.debug("Creating the dialog container");var e=document.getElementById("apice-dialog");e||((e=document.createElement("div")).id="apice-dialog",e.className="apc-dialog",document.body.appendChild(e)),e=z(e),Wn.container=e,Wn.closing=document.createElement("button"),Wn.closing.innerHTML="&nbsp;",Tn(e,"apc-closing").content(Wn.closing),Wn.header=Tn(e,"apc-header"),Wn.body=Tn(e,"apc-body"),Wn.footer=Tn(e,"apc-footer apc-button-bar")}}(),En.debug("Displaying the dialog container"),t();var n=[];return n[0]=bn.show(),n[1]=new Promise((function(t){C.waitAnimation(Wn.container,"apc-dialog apc-open apc-"+e.style,t)})),Promise.all(n)}function xn(e,t){if(t){"string"==typeof t&&(t={label:t,close:!0});var n=document.createElement("button");n.className="apc-button",t.className&&(n.className+=" "+t.className),n.innerHTML=t.label,"function"==typeof t.action?n.onclick=function(){!1!==t.action()&&!1!==t.close&&e.close()}:t.close&&(n.onclick=function(){e.close()}),Wn.footer.append(n)}}Wn.current=null,Wn.queue=[],Wn.container=null,Wn.closing=null,Wn.header=null,Wn.body=null,Wn.footer=null,Wn.status=0,Wn.titles={},Wn.titles.error="Atention!",Wn.titles.warn="Warning!",Wn.titles.info="Information",Wn.titles.success="Success!";var Sn=new WeakMap,An=new WeakMap,Ln=new WeakMap,Cn=new WeakMap,Pn=new WeakMap,Nn=new WeakMap,Rn=function(){function e(n){t(this,e),Sn.set(this,{writable:!0,value:void 0}),An.set(this,{writable:!0,value:void 0}),Ln.set(this,{writable:!0,value:void 0}),Cn.set(this,{writable:!0,value:void 0}),Pn.set(this,{writable:!0,value:void 0}),Nn.set(this,{writable:!0,value:void 0}),n.id||(n.id="dialog_".concat(J.tinyId())),v(this,Sn,n.id),v(this,An,n.style),v(this,Cn,n.title),v(this,Pn,n.body),v(this,Nn,[]),v(this,Ln,{}),p(this,Ln).close=[]}return i(e,[{key:"id",get:function(){return p(this,Sn)}},{key:"title",get:function(){return p(this,Cn)?p(this,Cn):Wn.titles[p(this,An)]}},{key:"style",get:function(){return p(this,An)}},{key:"open",value:function(){var e=this;return Wn.current===this?(En.debug("The dialog instance is already opened. id={0}",this.id),Promise.resolve()):Wn.current?(En.debug("Another dialog instance is opened. The current dialog is queued. id={0}",this.id),new Promise((function(t,n){Wn.queue.push({dialog:e,resolve:t,reject:n})}))):(En.debug("Opening dialog instance. id={0}",this.id),Wn.current=this,_n(this,(function(){Wn.closing.onclick=function(){e.close()},Wn.header.content(e.title),Wn.body.content(p(e,Pn)),Wn.footer.content("");for(var t=0;t<p(e,Nn).length;t++){var n=p(e,Nn)[t];xn(e,n)}})))}},{key:"close",value:function(){var e=this;return Wn.current!==this?(En.debug("The dialog cannot be closed because it is not opened. Removing it from the queue. id={0}",this.id),function(e){if(e){for(var t=0;t<Wn.queue.length;t++)if(Wn.queue[t].dialog===e)return Wn.queue.splice(t,1),void En.debug("The dialog has been removed. id={0}",e.id);En.warn("The dialog instance could not be removed from the queue since it was not found. id={0}",e.id)}}(this),Promise.resolve()):(En.debug("Closing dialog. id={0}",this.id),Wn.current=null,function(){if(0===Wn.status)return En.debug("Dialog container is already closed"),Promise.resolve();Wn.status=0,En.debug("Closing the dialog container");var e=[];return e[0]=bn.hide(),e[1]=new Promise((function(e){C.waitAnimation(Wn.container,"apc-dialog apc-closed",(function(){Wn.header.content(""),Wn.body.content(""),Wn.footer.content(""),e()}))})),Promise.all(e)}().then((function(){!function(e){for(var t=0;t<e.length;t++){var n=e[t];try{n()}catch(e){En.error("An error has occurred trying to execute an event listener",e)}}}(p(e,Ln).close),function(){if(0===Wn.queue.length)return En.debug("No more dialogs in the queue"),!1;En.debug("Opening the next dialog from the queue");var e=Wn.queue.shift();e.dialog.open().then(e.resolve).catch(e.reject)}()})))}},{key:"onClose",value:function(e){"function"==typeof e&&p(this,Ln).close.push(e)}},{key:"addButton",value:function(e){return e&&p(this,Nn).push(e),this}}]),e}();function jn(e,t){return"string"==typeof t?t={body:t}:t||(t={}),t.style=e,new Rn(t)}Mn.error=function(e){return jn("error",e)},Mn.warn=function(e){return jn("warn",e)},Mn.info=function(e){return jn("info",e)},Mn.success=function(e){return jn("success",e)};var qn={toast:$,form:bt,box:hn,dialog:Mn},Hn=0,In=1,On=7;function Bn(){return!0===arguments[0]?{major:Hn,minor:In,patch:On}:"v"+Hn+"."+In+"."+On}return console.log("%cApice Framework ".concat(Bn()),"color: #64dd17;"),{version:Bn,ready:function(e){C.documentReady(e)},logging:k,util:m,events:C,element:z,cookies:b,http:_e,controller:De,fragment:ot,router:ct,error:pe,ui:qn,form:bt,asynchronous:nn}}();
//# sourceMappingURL=apice.min.js.map
