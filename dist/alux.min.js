var Alux=function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function i(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,u(e,t,"get"))}function a(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,u(e,t,"set"),n),n}function u(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function s(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var l={},c={singletons:{}},h=new WeakMap,f=function(){function e(t){n(this,e),h.set(this,{writable:!0,value:void 0}),a(this,h,t)}return o(e,[{key:"count",get:function(){return i(this,h)?Array.isArray(i(this,h))?i(this,h).length:1:0}},{key:"html",value:function(){if(0===arguments.length)return i(this,h)?i(this,h).innerHTML:null;if(!i(this,h))return this;var t=arguments[0];return t?"string"==typeof t?i(this,h).innerHTML=t:t instanceof e&&(i(this,h).innerHTML=t.html()):i(this,h).innerHTML="",this}},{key:"on",value:function(e,t){if(!e)throw new Error("alux.element.on.no_event_name");return i(this,h)&&"function"==typeof t&&l.events.addListener(i(this,h),e,t),this}}]),e}();l.element=function(e){if(!e||"body"===e)return c.singletons.body||(c.singletons.body=new f(document.body)),c.singletons.body;if("window"===e)return c.singletons.window||(c.singletons.window=new f(window)),c.singletons.window;if(e instanceof f)return e;var n=t(e);if("string"===n){var r=document.querySelector(e);return new f(r)}return"object"===n?new f(e):new f},l.events={},c.events={},c.events.ready={completed:!1,listeners:[]},c.events.checkReadyState=!1,l.events.onReady=function(e){if(function(e,t){var n=c.events[e];if(!n)throw new Error("alux.events.unknown_event["+e+"]");if("function"!=typeof t)throw new Error("alux.events.invalid_listener");n.completed?t():n.listeners.push(t)}("ready",e),!c.events.checkReadyState){c.events.checkReadyState=!0;var t=function(){c.events.ready.completed=!0,c.events.ready.listeners.length>0&&c.events.ready.listeners.map((function(e){e()}))};"complete"===document.readyState?t():"function"==typeof document.addEventListener?document.addEventListener("DOMContentLoaded",t,!1):"function"==typeof document.attachEvent&&document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&t()}))}},l.events.addListener=function(e,t,n){if(!e)throw new Error("alux.util.event.invalid_target");if(!t||"string"!=typeof t)throw new Error("alux.util.event.invalid_event_name");"function"==typeof n&&("function"==typeof e.addEventListener?e.addEventListener(t,n,!1):"function"==typeof e.attachEvent&&e.attachEvent("on"+t,n))},l.isPromise=function(e){return e instanceof Promise},l.trim=function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},l.random={},l.random.tinyId=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},l.random.shortId=function(){return l.random.tinyId()+l.random.tinyId()},l.random.guid=function(){return l.random.shortId()+"-"+l.random.shortId()+"-"+l.random.shortId()+"-"+l.random.shortId()+l.random.shortId()};var v={set:function(e,t,n){if("string"!=typeof e)throw new Error("alux.cookies.set.invalid_name");if("number"!=typeof n)throw new Error("alux.cookies.set.invalid_timespan");var r=new Date;r.setTime(r.getTime()+1e3*n);var o=l.trim(e)+"="+t+"; expires="+r.toGMTString()+"; path=/";document.cookie=o},get:function(e){if("string"!=typeof e)throw new Error("alux.cookies.get.invalid_name");for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var r=l.trim(t[n]);if(r){var o=r.split("=");if(l.trim(o[0])===e)return o[1]}}return null}},d={},g={loggers:{},levels:{fatal:{value:10,color:"#ff4444",label:"FATAL"},error:{value:20,color:"#ff4444",label:"ERROR"},warn:{value:30,color:"#ff8800",label:"WARNING"},info:{value:40,color:"#0099cc",label:"INFO"},debug:{value:50,color:"#3E4551",label:"DEBUG"},trace:{value:60,color:"#3E4551",label:"TRACE"}}},w=v.get("alux.logger.level");function p(e,t,n,r){if(t.value>=n.value){for(var o,i=arguments.length,a=new Array(i>4?i-4:0),u=4;u<i;u++)a[u-4]=arguments[u];(o=console).log.apply(o,["%c["+n.label+"]["+e+"]: "+r].concat(["color: "+n.color].concat(a)))}}w?(g.globalLevel=g.levels[w],g.globalLevel||(g.globalLevel=g.levels.warn)):g.globalLevel=g.levels.warn;var m=new WeakMap,y=new WeakMap,b=function(){function e(t){n(this,e),m.set(this,{writable:!0,value:void 0}),y.set(this,{writable:!0,value:void 0}),a(this,m,t);var r=v.get("alux.logger.["+t+"].level");r?(a(this,y,g.levels[r]),i(this,y)||a(this,y,g.globalLevel)):a(this,y,g.globalLevel)}return o(e,[{key:"level",value:function(){if(0!==arguments.length){var e=g.levels[arguments[0]];if(!e)throw new Error("alux.logger.invalid_level["+arguments[0]+"]");a(this,y,e),v.set("alux.logger.["+i(this,m)+"].level",arguments[0],1800)}return i(this,y).label}},{key:"fatal",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];p.apply(void 0,[i(this,m),i(this,y),g.levels.fatal,e].concat(n))}},{key:"error",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];p.apply(void 0,[i(this,m),i(this,y),g.levels.error,e].concat(n))}},{key:"warn",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];p.apply(void 0,[i(this,m),i(this,y),g.levels.warn,e].concat(n))}},{key:"info",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];p.apply(void 0,[i(this,m),i(this,y),g.levels.info,e].concat(n))}},{key:"debug",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];p.apply(void 0,[i(this,m),i(this,y),g.levels.debug,e].concat(n))}},{key:"trace",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];p.apply(void 0,[i(this,m),i(this,y),g.levels.trace,e].concat(n))}}]),e}();d.getLogger=function(e){return g.loggers[e]||(g.loggers[e]=new b(e)),g.loggers[e]},d.level=function(){var e;if(1===arguments.length){var t=g.levels[arguments[0]];if(!t)throw new Error("alux.logger.invalid_level["+arguments[0]+"]");for(var n in g.globalLevel=t,v.set("alux.logger.level",arguments[0],1800),g.loggers){var r=g.loggers[n];r.level(arguments[0])}}else if(2===arguments.length){var o=d.getLogger(arguments[0]);return o.level(arguments[1]),o.level()}return null===(e=g.globalLevel)||void 0===e?void 0:e.label};var k={},x=new WeakMap,E=new WeakMap,_=new WeakMap,M=new WeakMap,W=new WeakMap,L=function(){function e(t){var r;n(this,e),x.set(this,{writable:!0,value:void 0}),E.set(this,{writable:!0,value:void 0}),_.set(this,{writable:!0,value:void 0}),M.set(this,{writable:!0,value:void 0}),W.set(this,{writable:!0,value:void 0}),a(this,W,l.random.guid()),a(this,E,t.message),a(this,_,t.cause),a(this,x,t.module),a(this,M,null!==(r=t.code)&&void 0!==r?r:"alux.error_handler")}return o(e,[{key:"guid",get:function(){return i(this,W)}},{key:"message",get:function(){var e;return null!==(e=i(this,E))&&void 0!==e?e:"An error has occurred. Please contact the technical support without closing this screen."}},{key:"cause",get:function(){return i(this,_)}},{key:"code",get:function(){return i(this,M)}},{key:"log",value:function(){var t=d.getLogger(i(this,x));"string"==typeof i(this,_)?t.error("["+i(this,W)+"]\n-> "+i(this,M)+"\n-> "+i(this,_)):i(this,_)?i(this,_)instanceof e?i(this,_).code&&i(this,_).cause?t.error("["+i(this,W)+"]\n-> "+i(this,M)+"\n-> "+i(this,_).code+"\n->",i(this,_).cause):i(this,_).code?t.error("["+i(this,W)+"]\n-> "+i(this,M)+"\n-> "+i(this,_).code):i(this,_).cause&&t.error("["+i(this,W)+"]\n-> "+i(this,M)+"\n->",i(this,_).cause):i(this,_)instanceof T?t.error("["+i(this,W)+"]\n-> "+i(this,M)+"\n-> http-error["+i(this,_).code+"]"):t.error("["+i(this,W)+"]\n-> "+i(this,M)+"\n->",i(this,_)):t.error("["+i(this,W)+"]\n-> "+i(this,M))}},{key:"render",value:function(e){var t=l.element(e);this.log(),t.html('<div class="badge badge-error">            <div class="header">Atention!</div>            <div class="content">'+this.message+'</div>            <div class="details">'+i(this,W)+"</div>        </div>")}}]),e}();k.create=function(e){return new L(e)},k.render=function(){var e=null,t=null;1===arguments.length?e=arguments[0]:2===arguments.length&&(t=arguments[0],e=arguments[1]),e&&(e instanceof L||(e=new L(e)),e.render(t))};var S=new WeakMap,T=function(){function e(t){n(this,e),S.set(this,{writable:!0,value:void 0}),a(this,S,t)}return o(e,[{key:"type",get:function(){return"http"}},{key:"code",get:function(){return i(this,S)}}]),e}();k.createHttpError=function(e){return new T(e)};var R={};function A(e,t){var n=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){throw Error("alux.http.xmlhttp_creation_error")}}}();return n.onreadystatechange=function(){4!=n.readyState&&"complete"!==n.readyState||(200==n.status?e(n.responseText):t(k.createHttpError(n.status)))},n}R.request=function(e,t){if("string"!=typeof e||!e)throw new Error("alux.http.null_url");return t||(t={}),t.method||(t.method="GET"),new Promise((function(n,r){var o=A(n,r);o.open(t.method,e,!1!==t.async),"GET"!==t.method&&t.data?o.send(t.data):o.send()}))},R.loadScript=function(e){return new Promise((function(t,n){var r=document.createElement("script");r.src=e,r.type="text/javascript",r.async=!1,r.onerror=function(){n(k.create({module:"alux.http",code:"alux.http.load_script_error["+e+"]"}))},r.onload=function(){t()},document.head.appendChild(r)}))};var P=new WeakMap,F=new WeakMap,j=new WeakMap,H=new WeakMap,I=function(){function e(t,r,o,u){var s;if(n(this,e),P.set(this,{writable:!0,value:void 0}),F.set(this,{writable:!0,value:void 0}),j.set(this,{writable:!0,value:void 0}),H.set(this,{writable:!0,value:void 0}),!i(this,F))throw new Error("alux.http.url.no_host");a(this,P,null!=t?t:"https"),a(this,F,r),a(this,j,null!=o?o:"80"),a(this,H,null!==(s=i(this,H))&&void 0!==s?s:"")}return o(e,[{key:"protocol",get:function(){return i(this,P)}},{key:"host",get:function(){return i(this,F)}},{key:"port",get:function(){return i(this,j)}},{key:"path",get:function(){return i(this,H)}},{key:"toString",value:function(){return i(this,P)+"://"+i(this,F)+":"+i(this,j)+"/"+i(this,H)}},{key:"resourceUrl",value:function(e,t,n){var r=this.toString();return e&&"string"==typeof e&&(r.endsWith("/")||e.startsWith("/")||(r+="/"),r+=e),t&&"string"==typeof t&&(t.startsWith("?")||(r+="?"),r+=t),n&&"string"==typeof n&&(n.startsWith("#")||(r+="#"),r+=n),r}},{key:"get",value:function(e,t,n){var r=this.resourceUrl(e,t,n);return R.request(r,{method:"GET"})}},{key:"post",value:function(e,t){var n=this.resourceUrl(e);return R.request(n,{method:"POST",data:t})}},{key:"put",value:function(e,t){var n=this.resourceUrl(e);return R.request(n,{method:"PUT",data:t})}},{key:"delete",value:function(e,t){var n=this.resourceUrl(e);return R.request(n,{method:"DELETE",data:t})}}]),e}(),q=new WeakMap,O=new WeakMap,G=new WeakMap,U=new WeakMap,D=function(){function e(){n(this,e),q.set(this,{writable:!0,value:void 0}),O.set(this,{writable:!0,value:void 0}),G.set(this,{writable:!0,value:void 0}),U.set(this,{writable:!0,value:void 0})}return o(e,[{key:"protocol",value:function(e){return a(this,q,e),this}},{key:"host",value:function(e){return a(this,O,e),this}},{key:"port",value:function(e){var n=t(e);if("string"===n)a(this,G,e);else{if("number"!==n)throw new Error("alux.http.url_builder.invalid_port");a(this,G,String(e))}return this}},{key:"path",value:function(e){return a(this,U,e),this}},{key:"build",value:function(){return new I(i(this,q),i(this,O),i(this,G),i(this,U))}}]),e}();R.url=function(){return new D};var X="alux.controller",C={controllers:{}},N=d.getLogger(X),B=function(e){if("string"==typeof e){var t=C.controllers[e];if(!t)throw new Error("alux.controller.unknown_controller["+e+"]");return t}},$=new WeakMap,z=new WeakMap,J=function(){function e(t,r){n(this,e),$.set(this,{writable:!0,value:void 0}),z.set(this,{writable:!0,value:void 0}),a(this,$,t),a(this,z,r)}return o(e,[{key:"name",get:function(){return i(this,$)}},{key:"declare",value:function(e){if("function"!=typeof e)throw new Error("alux.controller.declare.invalid_implementation["+i(this,$)+"]");a(this,z,e)}},{key:"serve",value:function(){var e=this,n=t(i(this,z));return"function"===n?(N.debug("Serving controller. controller="+i(this,$)),new Promise((function(t,n){try{i(e,z).call(e),t()}catch(t){n(k.create({module:X,cause:t,code:"alux.controller.serve.implementation_error["+i(e,$)+"]"}))}}))):"string"===n?(N.debug("Loading controller. controller="+i(this,$)),new Promise((function(t,n){R.loadScript(i(e,z)).then((function(){setTimeout((function(){B(i(e,$)).serve().then(t).catch(n)}),0)})).catch((function(t){n(k.create({module:X,cause:t,code:"alux.controller.load_script_error["+i(e,$)+"]"}))}))}))):Promise.reject(k.create({module:X,code:"alux.controller.bad_implementation["+i(this,$)+"]"}))}}]),e}();B.register=function(e,t){N.debug("Registering controller. controller="+e);var n=new J(e,t);return C.controllers[e]=n,n},B.declare=function(e,t){N.debug("Declaring controller. controller="+e);var n=C.controllers[e];if(!n)throw new Error("alux.controller.declare.unknown_controller["+e+"]");n.declare(t)},B.isController=function(e){return e&&e instanceof J};var K="alux.fragment",Q={fragments:{}},V=d.getLogger(K),Y=new WeakMap,Z=new WeakMap,ee=new WeakMap,te=new WeakSet,ne=function(){function e(t,r,o){n(this,e),te.add(this),Y.set(this,{writable:!0,value:void 0}),Z.set(this,{writable:!0,value:void 0}),ee.set(this,{writable:!0,value:void 0}),a(this,Y,t),a(this,Z,r),a(this,ee,o)}return o(e,[{key:"name",get:function(){return i(this,Y)}},{key:"serve",value:function(e,t){var n=this,r=l.element(e);if(0===r.count)return Promise.reject(k.create({module:K,code:"alux.fragment.serve.target_not_found["+e+"]"}));V.debug("Serving fragment. fragment="+i(this,Y));var o=function(e,t){R.request(i(n,Z),{method:"GET"}).then((function(o){setTimeout((function(){r.html(o),s(n,te,re).call(n).then(e).catch(t)}),0)})).catch((function(e){t(k.create({module:K,message:"An error has occurred trying to load a fragment of content",cause:e,code:"alux.fragment.serve_error["+n.name+"]"}))}))};if(!0===t)return new Promise((function(e,t){o(e,t)}));o((function(){}),(function(e){k.render(r,e)}))}}]),e}();function re(){var e=this;return new Promise((function(n,r){i(e,ee)?setTimeout((function(){var o=t(i(e,ee));if("function"===o){V.debug("Serving fragment controller function. fragment="+i(e,Y));try{i(e,ee).call(e),n()}catch(t){r(k.create({module:K,cause:t,code:"alux.fragment.controller_implementation_error["+i(e,Y)+"]"}))}}else"string"===o&&(V.debug("Serving fragment controller. fragment="+i(e,Y)+" controller="+i(e,ee)),B(i(e,ee)).serve().then(n).catch((function(t){r(k.create({module:K,cause:t,code:"alux.fragment.controller_serve_error["+e.name+"]"}))})))})):n()}))}var oe=function(e){if("string"==typeof e){var t=Q.fragments[e];if(!t)throw new Error("alux.fragment.unknown_fragment["+e+"]");return t}};oe.register=function(e,t,n){V.debug("Registering fragment. fragment="+e);var r=new ne(e,t,n);return Q.fragments[e]=r,r},oe.isFragment=function(e){return e&&e instanceof ne};var ie={},ae="alux.router",ue={routes:[],defaultRoute:null,notFoundRoute:null,target:null},se=d.getLogger(ae);function le(e){se.debug("Hash change triggered. event="+e);var t=ie.hash(),n=ie.match(t);if(n)se.debug("Serving route: "+n.pattern);else if(!ue.defaultRoute||t&&ue.notFoundRoute){if(!ue.notFoundRoute)return void k.render({module:ae,message:"The requested resource was not found: "+t,code:"alux.router.no_matching_no_default"});se.warn("Route not found. hash="+t+" route="+ue.notFoundRoute.pattern),n=ue.notFoundRoute}else t?se.warn("Route not found. Serving default hash="+t):se.debug("No hash found. Serving default router"),n=ue.defaultRoute;n.serve(t)}var ce=new WeakMap,he=new WeakMap,fe=new WeakMap,ve=new WeakSet,de=function(){function e(t){if(n(this,e),ve.add(this),ce.set(this,{writable:!0,value:void 0}),he.set(this,{writable:!0,value:void 0}),fe.set(this,{writable:!0,value:void 0}),!t||"string"!=typeof t)throw Error("alux.router.hah.invalid_pattern");a(this,ce,t),s(this,ve,ge).call(this)}return o(e,[{key:"pattern",get:function(){return i(this,ce)}},{key:"count",get:function(){return i(this,he).length}},{key:"hasParameters",get:function(){return i(this,fe).length>0}}]),e}();function ge(){a(this,he,[]),a(this,fe,[]);for(var e=i(this,ce).split("/"),t=0;t<e.length;t++){var n=e[t];n.startsWith(":")&&i(this,fe).push(n.substr(1)),i(this,he).push(n)}}var we=new WeakMap,pe=new WeakMap,me=function(){function e(t,r){if(n(this,e),we.set(this,{writable:!0,value:void 0}),pe.set(this,{writable:!0,value:void 0}),!t||"string"!=typeof t)throw new Error("alux.route.constructor.invalid_route_value");if(!r)throw new Error("alux.route.constructor.missing_route_action");a(this,we,new de(t)),a(this,pe,r)}return o(e,[{key:"pattern",get:function(){return i(this,we).pattern}},{key:"asDefault",value:function(){ue.defaultRoute=this}},{key:"asNotFound",value:function(){ue.notFoundRoute=this}},{key:"match",value:function(e){return!i(this,we).hasParameters&&e===i(this,we).pattern}},{key:"serve",value:function(e){if("function"==typeof i(this,pe))try{i(this,pe).call(this,e)}catch(t){se.error("alux.router.action_error["+this.pattern+"|"+e+"]",t)}else if(oe.isFragment(i(this,pe)))i(this,pe).serve(ue.target);else{if("function"!=typeof i(this,pe).serve)throw Error("aux.route.invalid_action["+this.pattern+"]");i(this,pe).serve()}}}]),e}();ie.register=function(e,t){se.debug("Registering route. pattern="+e);var n=new me(e,t);return ue.routes.push(n),n},ie.match=function(e){if(!e||"string"!=typeof e)return null;for(var t=0;t<ue.routes.length;t++){var n=ue.routes[t];if(!0===n.match(e))return n}return null},ie.hash=function(){var e=window.location.hash;return e.startsWith("#")&&(e=e.substr(1)),e},ie.start=function(){return se.debug("Starting Alux router"),l.events.addListener(window,"hashchange",(function(){le("hashchange")})),l.events.addListener(window,"popstate",(function(){return le("popstate"),!1})),l.events.onReady((function(){le("routerstart")})),ie},ie.target=function(){if(0===arguments.length)return ue.target?ue.target:document.body;var e=arguments[0];return e?(ue.target=l.element(e),ue.target||(se.error("alux.router.target_not_found["+e+"]"),ue.target=document.body),ie):(ue.target=document.body,ie)};var ye={},be={};function ke(){var e=arguments[0];console.log(e,arguments)}be.styles={},be.styles.info={title:"Information",icon:"",color:{}},ye.info=function(){ke.apply(void 0,["info"].concat(Array.prototype.slice.call(arguments)))};var xe={toast:ye},Ee={};function _e(){return 1===arguments.length&&!0===arguments[0]?{major:Ee.version.major,minor:Ee.version.minor,patch:Ee.version.patch}:"v"+Ee.version.major+"."+Ee.version.minor+"."+Ee.version.patch}return Ee.version={major:1,minor:0,patch:0},console.log("%cAlux Framework "+_e(),"color: #64dd17;"),e.controller=B,e.cookies=v,e.errorHandler=k,e.fragment=oe,e.handle=function(e){if(!l.isPromise(e))throw Error("alux.handle_promise.invalid_promise");e.catch((function(e){k.render(e)}))},e.http=R,e.log=d,e.ready=function(e){l.events.onReady(e)},e.router=ie,e.ui=xe,e.util=l,e.version=_e,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=alux.min.js.map
