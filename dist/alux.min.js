var Alux=function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function i(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,l(e,t,"get"))}function a(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,l(e,t,"set"),n),n}function l(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var u={},s={singletons:{}},c=new WeakMap,h=function(){function e(t){n(this,e),c.set(this,{writable:!0,value:void 0}),a(this,c,t)}return o(e,[{key:"count",get:function(){return i(this,c)?Array.isArray(i(this,c))?i(this,c).length:1:0}},{key:"html",value:function(){if(0===arguments.length)return i(this,c)?i(this,c).innerHTML:null;if(!i(this,c))return this;var t=arguments[0];return t?"string"==typeof t?i(this,c).innerHTML=t:t instanceof e&&(i(this,c).innerHTML=t.html()):i(this,c).innerHTML="",this}},{key:"on",value:function(e,t){if(!e)throw new Error("alux.element.on.no_event_name");return i(this,c)&&"function"==typeof t&&u.events.addListener(i(this,c),e,t),this}}]),e}();u.element=function(e){if(!e||"body"===e)return s.singletons.body||(s.singletons.body=new h(document.body)),s.singletons.body;if("window"===e)return s.singletons.window||(s.singletons.window=new h(window)),s.singletons.window;if(e instanceof h)return e;var n=t(e);if("string"===n){var r=document.querySelector(e);return new h(r)}return"object"===n?new h(e):new h},u.events={},s.events={},s.events.ready={completed:!1,listeners:[]},s.events.checkReadyState=!1,u.events.onReady=function(e){if(function(e,t){var n=s.events[e];if(!n)throw new Error("alux.events.unknown_event["+e+"]");if("function"!=typeof t)throw new Error("alux.events.invalid_listener");n.completed?t():n.listeners.push(t)}("ready",e),!s.events.checkReadyState){s.events.checkReadyState=!0;var t=function(){s.events.ready.completed=!0,s.events.ready.listeners.length>0&&s.events.ready.listeners.map((function(e){e()}))};"complete"===document.readyState?t():"function"==typeof document.addEventListener?document.addEventListener("DOMContentLoaded",t,!1):"function"==typeof document.attachEvent&&document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&t()}))}},u.events.addListener=function(e,t,n){if(!e)throw new Error("alux.util.event.invalid_target");if(!t||"string"!=typeof t)throw new Error("alux.util.event.invalid_event_name");"function"==typeof n&&("function"==typeof e.addEventListener?e.addEventListener(t,n,!1):"function"==typeof e.attachEvent&&e.attachEvent("on"+t,n))},u.isPromise=function(e){return e instanceof Promise},u.trim=function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},u.random={},u.random.tinyId=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},u.random.shortId=function(){return u.random.tinyId()+u.random.tinyId()},u.random.guid=function(){return u.random.shortId()+"-"+u.random.shortId()+"-"+u.random.shortId()+"-"+u.random.shortId()+u.random.shortId()};var f={set:function(e,t,n){if("string"!=typeof e)throw new Error("alux.cookies.set.invalid_name");if("number"!=typeof n)throw new Error("alux.cookies.set.invalid_timespan");var r=new Date;r.setTime(r.getTime()+1e3*n);var o=u.trim(e)+"="+t+"; expires="+r.toGMTString()+"; path=/";document.cookie=o},get:function(e){if("string"!=typeof e)throw new Error("alux.cookies.get.invalid_name");for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var r=u.trim(t[n]);if(r){var o=r.split("=");if(u.trim(o[0])===e)return o[1]}}return null}},v={},d={loggers:{},levels:{fatal:{value:10,color:"#ff4444",label:"FATAL"},error:{value:20,color:"#ff4444",label:"ERROR"},warn:{value:30,color:"#ff8800",label:"WARNING"},info:{value:40,color:"#0099cc",label:"INFO"},debug:{value:50,color:"#3E4551",label:"DEBUG"},trace:{value:60,color:"#3E4551",label:"TRACE"}}},g=f.get("alux.logger.level");function w(e,t,n,r){if(t.value>=n.value){for(var o,i=arguments.length,a=new Array(i>4?i-4:0),l=4;l<i;l++)a[l-4]=arguments[l];(o=console).log.apply(o,["%c["+n.label+"]["+e+"]: "+r].concat(["color: "+n.color].concat(a)))}}g?(d.globalLevel=d.levels[g],d.globalLevel||(d.globalLevel=d.levels.warn)):d.globalLevel=d.levels.warn;var p=new WeakMap,m=new WeakMap,y=function(){function e(t){n(this,e),p.set(this,{writable:!0,value:void 0}),m.set(this,{writable:!0,value:void 0}),a(this,p,t);var r=f.get("alux.logger.["+t+"].level");r?(a(this,m,d.levels[r]),i(this,m)||a(this,m,d.globalLevel)):a(this,m,d.globalLevel)}return o(e,[{key:"level",value:function(){if(0!==arguments.length){var e=d.levels[arguments[0]];if(!e)throw new Error("alux.logger.invalid_level["+arguments[0]+"]");a(this,m,e),f.set("alux.logger.["+i(this,p)+"].level",arguments[0],1800)}return i(this,m).label}},{key:"fatal",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];w.apply(void 0,[i(this,p),i(this,m),d.levels.fatal,e].concat(n))}},{key:"error",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];w.apply(void 0,[i(this,p),i(this,m),d.levels.error,e].concat(n))}},{key:"warn",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];w.apply(void 0,[i(this,p),i(this,m),d.levels.warn,e].concat(n))}},{key:"info",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];w.apply(void 0,[i(this,p),i(this,m),d.levels.info,e].concat(n))}},{key:"debug",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];w.apply(void 0,[i(this,p),i(this,m),d.levels.debug,e].concat(n))}},{key:"trace",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];w.apply(void 0,[i(this,p),i(this,m),d.levels.trace,e].concat(n))}}]),e}();v.getLogger=function(e){return d.loggers[e]||(d.loggers[e]=new y(e)),d.loggers[e]},v.level=function(){var e;if(1===arguments.length){var t=d.levels[arguments[0]];if(!t)throw new Error("alux.logger.invalid_level["+arguments[0]+"]");for(var n in d.globalLevel=t,f.set("alux.logger.level",arguments[0],1800),d.loggers){var r=d.loggers[n];r.level(arguments[0])}}else if(2===arguments.length){var o=v.getLogger(arguments[0]);return o.level(arguments[1]),o.level()}return null===(e=d.globalLevel)||void 0===e?void 0:e.label};var b={},k=new WeakMap,x=new WeakMap,E=new WeakMap,_=new WeakMap,M=new WeakMap,L=function(){function e(t){var r;n(this,e),k.set(this,{writable:!0,value:void 0}),x.set(this,{writable:!0,value:void 0}),E.set(this,{writable:!0,value:void 0}),_.set(this,{writable:!0,value:void 0}),M.set(this,{writable:!0,value:void 0}),a(this,M,u.random.guid()),a(this,x,t.message),a(this,E,t.cause),a(this,k,t.module),a(this,_,null!==(r=t.code)&&void 0!==r?r:"alux.error_handler")}return o(e,[{key:"guid",get:function(){return i(this,M)}},{key:"message",get:function(){var e;return null!==(e=i(this,x))&&void 0!==e?e:"An error has occurred. Please contact the technical support without closing this screen."}},{key:"cause",get:function(){return i(this,E)}},{key:"code",get:function(){return i(this,_)}},{key:"log",value:function(){var t=v.getLogger(i(this,k));"string"==typeof i(this,E)?t.error("["+i(this,M)+"]\n-> "+i(this,_)+"\n-> "+i(this,E)):i(this,E)?i(this,E)instanceof e?i(this,E).code&&i(this,E).cause?t.error("["+i(this,M)+"]\n-> "+i(this,_)+"\n-> "+i(this,E).code+"\n->",i(this,E).cause):i(this,E).code?t.error("["+i(this,M)+"]\n-> "+i(this,_)+"\n-> "+i(this,E).code):i(this,E).cause&&t.error("["+i(this,M)+"]\n-> "+i(this,_)+"\n->",i(this,E).cause):i(this,E)instanceof S?t.error("["+i(this,M)+"]\n-> "+i(this,_)+"\n-> http-error["+i(this,E).code+"]"):t.error("["+i(this,M)+"]\n-> "+i(this,_)+"\n->",i(this,E)):t.error("["+i(this,M)+"]\n-> "+i(this,_))}},{key:"render",value:function(e){var t=u.element(e);this.log(),t.html('<div class="badge badge-error">            <div class="header">Atention!</div>            <div class="content">'+this.message+'</div>            <div class="details">'+i(this,M)+"</div>        </div>")}}]),e}();b.create=function(e){return new L(e)},b.render=function(){var e=null,t=null;1===arguments.length?e=arguments[0]:2===arguments.length&&(e=arguments[1],t=arguments[0]),e&&(!e instanceof L&&(e=new L(e)),e.render(t))};var W=new WeakMap,S=function(){function e(t){n(this,e),W.set(this,{writable:!0,value:void 0}),a(this,W,t)}return o(e,[{key:"type",get:function(){return"http"}},{key:"code",get:function(){return i(this,W)}}]),e}();b.createHttpError=function(e){return new S(e)};var T={};function A(e,t){var n=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){throw Error("alux.http.xmlhttp_creation_error")}}}();return n.onreadystatechange=function(){4!=n.readyState&&"complete"!==n.readyState||(200==n.status?e(n.responseText):t(b.createHttpError(n.status)))},n}T.request=function(e,t){if("string"!=typeof e||!e)throw new Error("alux.http.null_url");return t||(t={}),t.method||(t.method="GET"),new Promise((function(n,r){var o=A(n,r);o.open(t.method,e,!1!==t.async),"GET"!==t.method&&t.data?o.send(t.data):o.send()}))},T.loadScript=function(e){return new Promise((function(t,n){var r=document.createElement("script");r.src=e,r.type="text/javascript",r.async=!1,r.onerror=function(){n(b.create({module:"alux.http",code:"alux.http.load_script_error["+e+"]"}))},r.onload=function(){t()},document.head.appendChild(r)}))};var R=new WeakMap,P=new WeakMap,j=new WeakMap,H=new WeakMap,I=function(){function e(t,r,o,l){var u;if(n(this,e),R.set(this,{writable:!0,value:void 0}),P.set(this,{writable:!0,value:void 0}),j.set(this,{writable:!0,value:void 0}),H.set(this,{writable:!0,value:void 0}),!i(this,P))throw new Error("alux.http.url.no_host");a(this,R,null!=t?t:"https"),a(this,P,r),a(this,j,null!=o?o:"80"),a(this,H,null!==(u=i(this,H))&&void 0!==u?u:"")}return o(e,[{key:"protocol",get:function(){return i(this,R)}},{key:"host",get:function(){return i(this,P)}},{key:"port",get:function(){return i(this,j)}},{key:"path",get:function(){return i(this,H)}},{key:"toString",value:function(){return i(this,R)+"://"+i(this,P)+":"+i(this,j)+"/"+i(this,H)}},{key:"resourceUrl",value:function(e,t,n){var r=this.toString();return e&&"string"==typeof e&&(r.endsWith("/")||e.startsWith("/")||(r+="/"),r+=e),t&&"string"==typeof t&&(t.startsWith("?")||(r+="?"),r+=t),n&&"string"==typeof n&&(n.startsWith("#")||(r+="#"),r+=n),r}},{key:"get",value:function(e,t,n){var r=this.resourceUrl(e,t,n);return T.request(r,{method:"GET"})}},{key:"post",value:function(e,t){var n=this.resourceUrl(e);return T.request(n,{method:"POST",data:t})}},{key:"put",value:function(e,t){var n=this.resourceUrl(e);return T.request(n,{method:"PUT",data:t})}},{key:"delete",value:function(e,t){var n=this.resourceUrl(e);return T.request(n,{method:"DELETE",data:t})}}]),e}(),F=new WeakMap,q=new WeakMap,O=new WeakMap,G=new WeakMap,U=function(){function e(){n(this,e),F.set(this,{writable:!0,value:void 0}),q.set(this,{writable:!0,value:void 0}),O.set(this,{writable:!0,value:void 0}),G.set(this,{writable:!0,value:void 0})}return o(e,[{key:"protocol",value:function(e){return a(this,F,e),this}},{key:"host",value:function(e){return a(this,q,e),this}},{key:"port",value:function(e){var n=t(e);if("string"===n)a(this,O,e);else{if("number"!==n)throw new Error("alux.http.url_builder.invalid_port");a(this,O,String(e))}return this}},{key:"path",value:function(e){return a(this,G,e),this}},{key:"build",value:function(){return new I(i(this,F),i(this,q),i(this,O),i(this,G))}}]),e}();T.url=function(){return new U};var D="alux.controller",X={controllers:{}},C=v.getLogger(D),N=function(e){if("string"==typeof e){var t=X.controllers[e];if(!t)throw new Error("alux.controller.unknown_controller["+e+"]");return t}},B=new WeakMap,$=new WeakMap,z=function(){function e(t,r){n(this,e),B.set(this,{writable:!0,value:void 0}),$.set(this,{writable:!0,value:void 0}),a(this,B,t),a(this,$,r)}return o(e,[{key:"name",get:function(){return i(this,B)}},{key:"declare",value:function(e){if("function"!=typeof e)throw new Error("alux.controller.declare.invalid_implementation["+i(this,B)+"]");a(this,$,e)}},{key:"serve",value:function(){var e=this,n=t(i(this,$));return"function"===n?(C.debug("Serving controller. controller="+i(this,B)),new Promise((function(t,n){try{i(e,$).call(e),t()}catch(t){n(b.create({module:D,cause:t,code:"alux.controller.serve.implementation_error["+i(e,B)+"]"}))}}))):"string"===n?(C.debug("Loading controller. controller="+i(this,B)),new Promise((function(t,n){T.loadScript(i(e,$)).then((function(){setTimeout((function(){N(i(e,B)).serve().then(t).catch(n)}),0)})).catch((function(t){n(b.create({module:D,cause:t,code:"alux.controller.load_script_error["+i(e,B)+"]"}))}))}))):Promise.reject(b.create({module:D,code:"alux.controller.bad_implementation["+i(this,B)+"]"}))}}]),e}();N.register=function(e,t){C.debug("Registering controller. controller="+e);var n=new z(e,t);return X.controllers[e]=n,n},N.declare=function(e,t){C.debug("Declaring controller. controller="+e);var n=X.controllers[e];if(!n)throw new Error("alux.controller.declare.unknown_controller["+e+"]");n.declare(t)},N.isController=function(e){return e&&e instanceof z};var J="alux.fragment",K={fragments:{}},Q=v.getLogger(J),V=new WeakMap,Y=new WeakMap,Z=new WeakMap,ee=new WeakSet,te=function(){function e(t,r,o){n(this,e),ee.add(this),V.set(this,{writable:!0,value:void 0}),Y.set(this,{writable:!0,value:void 0}),Z.set(this,{writable:!0,value:void 0}),a(this,V,t),a(this,Y,r),a(this,Z,o)}return o(e,[{key:"name",get:function(){return i(this,V)}},{key:"serve",value:function(e,t){var n=this,r=u.element(e);if(0===r.count)return Promise.reject(b.create({module:J,code:"alux.fragment.serve.target_not_found["+e+"]"}));Q.debug("Serving fragment. fragment="+i(this,V));var o=function(e,t){T.request(i(n,Y),{method:"GET"}).then((function(o){setTimeout((function(){r.html(o),function(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}(n,ee,ne).call(n).then(e).catch(t)}),0)})).catch((function(e){t(b.create({module:J,message:"An error has occurred trying to load a fragment of content",cause:e,code:"alux.fragment.serve_error["+n.name+"]"}))}))};if(!0===t)return new Promise((function(e,t){o(e,t)}));o((function(){}),(function(e){b.render(r,e)}))}}]),e}();function ne(){var e=this;return new Promise((function(n,r){i(e,Z)?setTimeout((function(){var o=t(i(e,Z));if("function"===o){Q.debug("Serving fragment controller function. fragment="+i(e,V));try{i(e,Z).call(e),n()}catch(t){r(b.create({module:J,cause:t,code:"alux.fragment.controller_implementation_error["+i(e,V)+"]"}))}}else"string"===o&&(Q.debug("Serving fragment controller. fragment="+i(e,V)+" controller="+i(e,Z)),N(i(e,Z)).serve().then(n).catch((function(t){r(b.create({module:J,cause:t,code:"alux.fragment.controller_serve_error["+e.name+"]"}))})))})):n()}))}var re=function(e){if("string"==typeof e){var t=K.fragments[e];if(!t)throw new Error("alux.fragment.unknown_fragment["+e+"]");return t}};re.register=function(e,t,n){Q.debug("Registering fragment. fragment="+e);var r=new te(e,t,n);return K.fragments[e]=r,r},re.isFragment=function(e){return e&&e instanceof te};var oe={},ie="alux.router",ae={routes:[],defaultRoute:null},le=v.getLogger(ie);function ue(e){le.debug("Hash change triggered. event="+e);var t=oe.hash(),n=oe.match(t);n?le.debug("Serving route: "+n.pattern):ae.defaultRoute?(le.debug("Serving default route: "+ae.defaultRoute.pattern),ae.defaultRoute.serve()):b.render({module:ie,code:"alux.router.no_matching_no_default"})}oe.start=function(){le.debug("Starting Alux router"),u.events.addListener(window,"hashchange",(function(){ue("hashchange")})),u.events.addListener(window,"popstate",(function(){return ue("popstate"),!1})),u.events.onReady((function(){ue("routerstart")}))};var se=new WeakMap,ce=new WeakMap,he=function(){function e(t){if(n(this,e),se.set(this,{writable:!0,value:void 0}),ce.set(this,{writable:!0,value:void 0}),!t||"string"!=typeof t)throw Error("alux.router.hah.invalid_pattern");a(this,se,t),a(this,ce,i(this,se).split("/"))}return o(e,[{key:"pattern",get:function(){return i(this,se)}},{key:"count",get:function(){return i(this,ce).length}}]),e}(),fe=new WeakMap,ve=new WeakMap,de=function(){function e(t,r){if(n(this,e),fe.set(this,{writable:!0,value:void 0}),ve.set(this,{writable:!0,value:void 0}),!t||"string"!=typeof t)throw new Error("alux.route.constructor.invalid_route_value");if(!r)throw new Error("alux.route.constructor.missing_route_action");a(this,fe,new he(t)),a(this,ve,r)}return o(e,[{key:"pattern",get:function(){return i(this,fe).pattern}},{key:"asDefault",value:function(){ae.defaultRoute=this}},{key:"serve",value:function(){if("function"==typeof i(this,ve))try{i(this,ve).call(this)}catch(e){le.error("alux.router.action_error["+this.pattern+"]",e)}else"function"==typeof i(this,ve).serve&&i(this,ve).serve()}}]),e}();oe.register=function(e,t){le.debug("Registering route. pattern="+e);var n=new de(e,t);return ae.routes.push(n),n},oe.match=function(e){return null},oe.hash=function(){var e=window.location.hash;return e.startsWith("#")&&(e=e.substr(1)),e};var ge={};function we(){return 1===arguments.length&&!0===arguments[0]?{major:ge.version.major,minor:ge.version.minor,patch:ge.version.patch}:"v"+ge.version.major+"."+ge.version.minor+"."+ge.version.patch}return ge.version={major:1,minor:0,patch:0},console.log("%cAlux Framework "+we(),"color: #64dd17;"),e.controller=N,e.cookies=f,e.fragment=re,e.handle=function(e){if(!u.isPromise(e))throw Error("alux.handle_promise.invalid_promise");e.catch((function(e){b.render(e)}))},e.http=T,e.log=v,e.ready=function(e){u.events.onReady(e)},e.router=oe,e.util=u,e.version=we,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=alux.min.js.map
